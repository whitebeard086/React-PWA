import{h as z,i as E,ce as R,j as e,z as i,T as f,ar as j,S as c,H as k,a as N,c as h,Q as D,r as v,cf as C,bx as _,c0 as P,a1 as A,a2 as I,cg as L,K as U,ch as S,ci as q,cj as F}from"./index-a992da42.js";import{B as H}from"./index-2c636ab6.js";import{B as O}from"./BillsComponent-3c0c31ca.js";import{s as T}from"./sendPushNotification-2a35c3f5.js";const $=z({name:"dashboard/state",initialState:{completeServiceDialog:!1,completeService:!1,confirmServiceDialog:!1,confirmService:!1,bookingID:null},reducers:{setBookingID:(s,t)=>{s.bookingID=t.payload},setConfirmService:(s,t)=>{s.confirmService=t.payload},setCompleteService:(s,t)=>{s.completeService=t.payload},toggleCompleteServiceDialog:(s,t)=>{s.completeServiceDialog=t.payload},toggleConfirmServiceDialog:(s,t)=>{s.confirmServiceDialog=t.payload}}}),{setBookingID:V,setConfirmService:le,setCompleteService:ce,toggleConfirmServiceDialog:te,toggleCompleteServiceDialog:y}=$.actions,G=$.reducer,K=E({state:G,data:R}),Q=()=>e.jsxs("div",{children:[e.jsx("h4",{children:"Active Bookings"}),e.jsxs("div",{className:"mt-4 mb-4 flex gap-4 overflow-auto pb-4",children:[e.jsx(i,{className:"min-w-[18rem] w-80",bodyClass:"flex w-full flex-col justify-center items-center",children:e.jsxs("div",{className:"w-full flex items-center gap-4",children:[e.jsxs("div",{className:"w-1/2 flex flex-col items-center",children:[e.jsx(f,{size:"lg",shape:"circle",icon:e.jsx(j,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(c,{width:"80%"}),e.jsx(c,{width:"100%"})]})]}),e.jsx(c,{width:"50%",height:"30px"})]})}),e.jsx(i,{className:"min-w-[18rem] w-80",bodyClass:"flex w-full flex-col justify-center items-center",children:e.jsxs("div",{className:"w-full flex items-center gap-4",children:[e.jsxs("div",{className:"w-1/2 flex flex-col items-center",children:[e.jsx(f,{size:"lg",shape:"circle",icon:e.jsx(j,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(c,{width:"80%"}),e.jsx(c,{width:"100%"})]})]}),e.jsx(c,{width:"50%",height:"30px"})]})}),e.jsx(i,{className:"min-w-[18rem] w-80",bodyClass:"flex w-full flex-col justify-center items-center",children:e.jsxs("div",{className:"w-full flex items-center gap-4",children:[e.jsxs("div",{className:"w-1/2 flex flex-col items-center",children:[e.jsx(f,{size:"lg",shape:"circle",icon:e.jsx(j,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(c,{width:"80%"}),e.jsx(c,{width:"100%"})]})]}),e.jsx(c,{width:"50%",height:"30px"})]})})]}),e.jsx("h4",{children:"Unanswered Request Chats"}),e.jsxs("div",{className:"mt-4 mb-4 flex gap-4 overflow-auto pb-4",children:[e.jsxs(i,{className:"min-w-[10rem] w-40",bodyClass:"flex w-full flex-col justify-center items-center",children:[e.jsx(f,{size:"lg",shape:"circle",icon:e.jsx(j,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(c,{width:"80%"}),e.jsx(c,{width:"100%"})]})]}),e.jsxs(i,{className:"min-w-[10rem] w-40",bodyClass:"flex w-full flex-col justify-center items-center",children:[e.jsx(f,{size:"lg",shape:"circle",icon:e.jsx(j,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(c,{width:"80%"}),e.jsx(c,{width:"100%"})]})]}),e.jsxs(i,{className:"min-w-[10rem] w-40",bodyClass:"flex w-full flex-col justify-center items-center",children:[e.jsx(f,{size:"lg",shape:"circle",icon:e.jsx(j,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(c,{width:"80%"}),e.jsx(c,{width:"100%"})]})]}),e.jsxs(i,{className:"min-w-[10rem] w-40",bodyClass:"flex w-full flex-col justify-center items-center",children:[e.jsx(f,{size:"lg",shape:"circle",icon:e.jsx(j,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(c,{width:"80%"}),e.jsx(c,{width:"100%"})]})]})]}),e.jsxs("div",{className:"mt-4 mb-4 w-full flex items-center gap-4 overflow-auto pb-4",children:[e.jsx(i,{className:"w-1/2 min-w-[18rem] h-40",bodyClass:"h-full",children:e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 justify-center items-center",children:[e.jsx("h4",{children:"All Profile Views"}),e.jsx(c,{width:"30%",height:"15px"})]})}),e.jsx(i,{className:"w-1/2 min-w-[18rem] h-40",bodyClass:"h-full",children:e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 justify-center items-center",children:[e.jsx("h4",{children:"All Service Requests"}),e.jsx(c,{width:"30%",height:"15px"})]})})]}),e.jsx("div",{className:"col-span-4 w-full mt-4",children:e.jsx(i,{className:"bg-black",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold mb-2 text-white",children:"Bill Payments"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx(i,{bordered:!0,bodyClass:"p-0",className:"p-0",children:e.jsx(c,{height:"60px"})}),e.jsx(i,{bordered:!0,bodyClass:"p-0",className:"p-0",children:e.jsx(c,{height:"60px"})}),e.jsx(i,{bordered:!0,bodyClass:"p-0",className:"p-0",children:e.jsx(c,{height:"60px"})}),e.jsx(i,{bordered:!0,bodyClass:"p-0",className:"p-0",children:e.jsx(c,{height:"60px"})}),e.jsx(i,{bordered:!0,bodyClass:"p-0",className:"p-0",children:e.jsx(c,{height:"60px"})}),e.jsx(i,{bordered:!0,bodyClass:"p-0",className:"p-0",children:e.jsx(c,{height:"60px"})}),e.jsx(i,{bordered:!0,bodyClass:"p-0",className:"p-0",children:e.jsx(c,{height:"60px"})}),e.jsx(i,{bordered:!0,bodyClass:"p-0",className:"p-0",children:e.jsx(c,{height:"60px"})})]})]})})})]}),W=({data:s,imagePath:t})=>{const a=s==null?void 0:s.filter(l=>{var o;return((o=l.messages)==null?void 0:o.length)>0});return e.jsx(e.Fragment,{children:(a==null?void 0:a.length)<1?e.jsx("div",{className:"min-h-[20vh] w-full flex flex-col justify-center",children:e.jsxs("p",{className:"text-center text-gray-400 font-bold text-2xl",children:["You don't have ",e.jsx("br",{})," any unanswered chats..."]})}):e.jsx(e.Fragment,{children:a==null?void 0:a.map(l=>{var o,r,d,u,m;return e.jsx(k,{to:`/chat/${(o=l.user)==null?void 0:o.slug}`,state:{chat:l.id},children:e.jsxs(i,{className:"min-w-[10rem] w-40",bodyClass:"flex w-full flex-col justify-center items-center",children:[e.jsx(f,{size:"lg",shape:"circle",icon:e.jsx(j,{}),src:(r=l.user)!=null&&r.image?`${t}/${(d=l.user)==null?void 0:d.image}`:null}),e.jsx("h4",{className:"font-semibold text-base",children:`${(u=l==null?void 0:l.user)==null?void 0:u.first_name} ${(m=l==null?void 0:l.user)==null?void 0:m.last_name}`})]})},l.id)})})})},Y=({bookingsCount:s,profile:t})=>{var a;return e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"w-1/2 min-w-[18rem] h-40",bodyClass:"h-full",children:e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 justify-center items-center",children:[e.jsx("h4",{className:"text-gray-600",children:"All Profile Views"}),e.jsx("h4",{className:"font-semibold",children:(a=t==null?void 0:t.profile_views)==null?void 0:a.toLocaleString()})]})}),e.jsx(i,{className:"w-1/2 min-w-[18rem] h-40",bodyClass:"h-full",children:e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 justify-center items-center",children:[e.jsx("h4",{className:"text-gray-600",children:"All Service Requests"}),e.jsx("h4",{className:"font-semibold",children:s==null?void 0:s.toLocaleString()})]})})]})},J=()=>{const s=N(),{imagePath:t}=D,{enquiries:a,bookings:l,bookingsCount:o,booking:r,completingService:d,confirmingService:u}=h(x=>x.dashboard.data),{bookingID:m}=h(x=>x.dashboard.state),{profile:g,userType:n}=h(x=>x.auth.user),w=n==="Provider",p=a==null?void 0:a.filter(x=>x.messages.every(B=>B.sender_id!==(g==null?void 0:g.id)));console.log(p);const b=x=>{s(y(!0)),s(V(x==null?void 0:x.id))};return e.jsxs("div",{children:[e.jsx("h4",{children:"Active Bookings"}),e.jsx("div",{className:"mt-4 mb-4",children:e.jsx(H,{imagePath:t,bookings:l,isProvider:w,booking:r,completingService:d,confirmingService:u,bookingID:m,onComplete:b})}),e.jsx("h4",{children:"Unanswered Request Chats"}),e.jsx("div",{className:"mt-4 mb-4 flex gap-4 overflow-auto pb-4",children:e.jsx(W,{data:p,imagePath:t})}),e.jsx("div",{className:"mt-4 mb-4 w-full flex items-center gap-4 overflow-auto pb-4",children:e.jsx(Y,{bookingsCount:o,profile:g})}),e.jsx(O,{})]})},M=()=>{const s=N(),{completingService:t,serviceStatus:a,booking:l}=h(n=>n.dashboard.data),{completeServiceDialog:o,bookingID:r}=h(n=>n.dashboard.state),{profile:d}=h(n=>n.auth.user),u=(n,w,p,b)=>{A.push(e.jsx(I,{title:p||"Error",type:w||"warning",duration:b||3e3,children:n}),{placement:"top-center"})};v.useEffect(()=>{a==="error"&&u("Oops! Something went wrong, please try again.","danger","Error",4e3),s(C("idle"))},[a,s]),v.useEffect(()=>{var n,w,p;a==="success"&&(T({app_id:"9749386f-0c3b-417c-b986-3447a73296cd",channel_for_external_user_ids:"push",include_external_user_ids:[`${(n=l==null?void 0:l.user)==null?void 0:n.id}`],url:`${D.appURL}/chat/${d==null?void 0:d.username.toLowerCase()}`,contents:{en:`Hello ${(w=l==null?void 0:l.user)==null?void 0:w.username}, ${d==null?void 0:d.username} has completed your service, please inspect the work and confirm if you are satisfied.`},content_available:!0}),u("We have notified the user that booked this service that it has been completed, please wait a moment for them to confirm.","success","Success",8e3)),s(y(!1)),s(C("idle")),_.emit("completedService",(p=l==null?void 0:l.user)==null?void 0:p.id,console.log("Emit Service Completed, Dashboard: ",!0))},[a]);const m=()=>{s(y(!1))},g=()=>{s(L({booking_id:r}))};return e.jsx(P,{isOpen:o,onClose:m,onRequestClose:m,type:"success",title:"Service Completed?",onCancel:m,onConfirm:g,loading:t,children:e.jsx("p",{children:"Confirm that you have successfully completed this service?"})})};U("dashboard",K);const ae=()=>{const s=N(),{serviceCompleted:t,serviceConfirmed:a}=h(r=>r.dashboard.data),{serviceBooked:l}=h(r=>r.chat.data),{loading:o}=h(r=>r.dashboard.data);return v.useEffect(()=>{s(S())},[s]),v.useEffect(()=>{(t||a||l)&&s(S()),t?s(q(!1)):a&&s(F(!1))},[s,t,a,l]),e.jsxs("div",{className:"mt-10 mb-8 px-4",children:[o?e.jsx(Q,{}):e.jsx(J,{}),e.jsx(M,{socket:_.current})]})};export{ae as default};
