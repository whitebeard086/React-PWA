import{j as e,z as v,T as g,ar as w,S as r,bY as C,c as j,H as Y,bZ as J,bi as Q,Q as k,a as A,r as N,b_ as H,b$ as T,bx as D,c0 as V,a1 as U,a2 as W,c1 as Z,c2 as I,c3 as z,c4 as R,c5 as G,J as F,B as M,G as O,c6 as X,K as q,c7 as ee,c8 as se,c9 as te}from"./index-a992da42.js";import{E as ie,i as le}from"./react-textarea-autosize.browser.esm-f65a6054.js";import{s as K}from"./sendPushNotification-2a35c3f5.js";import{B as ce}from"./index-2c636ab6.js";import{A as ae}from"./index-0b63d60c.js";const ne=()=>e.jsxs("div",{children:[e.jsx("h4",{children:"Active Bookings"}),e.jsxs("div",{className:"mt-4 mb-4 flex gap-4 overflow-auto pb-4",children:[e.jsxs(v,{className:"min-w-[10rem] w-40",bodyClass:"flex w-full flex-col justify-center items-center",children:[e.jsx(g,{size:"lg",shape:"circle",icon:e.jsx(w,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(r,{width:"80%"}),e.jsx(r,{width:"100%"})]})]}),e.jsxs(v,{className:"min-w-[10rem] w-40",bodyClass:"flex w-full flex-col justify-center items-center",children:[e.jsx(g,{size:"lg",shape:"circle",icon:e.jsx(w,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(r,{width:"80%"}),e.jsx(r,{width:"100%"})]})]}),e.jsx(v,{className:"min-w-[18rem] w-80",bodyClass:"flex w-full flex-col justify-center items-center",children:e.jsxs("div",{className:"w-full flex items-center gap-4",children:[e.jsxs("div",{className:"w-1/2 flex flex-col items-center",children:[e.jsx(g,{size:"lg",shape:"circle",icon:e.jsx(w,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(r,{width:"80%"}),e.jsx(r,{width:"100%"})]})]}),e.jsx(r,{width:"50%",height:"30px"})]})})]}),e.jsx("h4",{children:"Enquiries"}),e.jsxs("div",{className:"mt-4",children:[e.jsx(v,{className:"rounded-none",children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"w-full flex gap-4 items-center",children:[e.jsx("div",{children:e.jsx(g,{size:"lg",shape:"circle",icon:e.jsx(w,{})})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center w-full",children:[e.jsx(r,{width:"40%"}),e.jsx(r,{width:"60%"})]})]}),e.jsx(C,{className:"text-xl"})]})}),e.jsx(v,{className:"rounded-none",children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"w-full flex gap-4 items-center",children:[e.jsx("div",{children:e.jsx(g,{size:"lg",shape:"circle",icon:e.jsx(w,{})})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center w-full",children:[e.jsx(r,{width:"40%"}),e.jsx(r,{width:"60%"})]})]}),e.jsx(C,{className:"text-xl"})]})}),e.jsx(v,{className:"rounded-none",children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"w-full flex gap-4 items-center",children:[e.jsx("div",{children:e.jsx(g,{size:"lg",shape:"circle",icon:e.jsx(w,{})})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center w-full",children:[e.jsx(r,{width:"40%"}),e.jsx(r,{width:"60%"})]})]}),e.jsx(C,{className:"text-xl"})]})}),e.jsx(v,{className:"rounded-none",children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"w-full flex gap-4 items-center",children:[e.jsx("div",{children:e.jsx(g,{size:"lg",shape:"circle",icon:e.jsx(w,{})})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center w-full",children:[e.jsx(r,{width:"40%"}),e.jsx(r,{width:"60%"})]})]}),e.jsx(C,{className:"text-xl"})]})}),e.jsx(v,{className:"rounded-none",children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"w-full flex gap-4 items-center",children:[e.jsx("div",{children:e.jsx(g,{size:"lg",shape:"circle",icon:e.jsx(w,{})})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center w-full",children:[e.jsx(r,{width:"40%"}),e.jsx(r,{width:"60%"})]})]}),e.jsx(C,{className:"text-xl"})]})})]})]}),re=()=>{const{imagePath:t}=k,{enquiries:d}=j(s=>s.requests.data),{profile:u}=j(s=>s.auth.user),i=d==null?void 0:d.filter(s=>{var l;return((l=s==null?void 0:s.messages)==null?void 0:l.length)>0});return e.jsx("div",{className:"mt-4 mb-4",children:(i==null?void 0:i.length)<1?e.jsx("div",{className:"min-h-[20vh] flex flex-col justify-center",children:e.jsxs("p",{className:"text-center text-gray-400 font-bold text-2xl",children:["No enquiries, ",e.jsx("br",{})," check back later..."]})}):e.jsx("div",{children:i==null?void 0:i.map(s=>{var x,p,m,a,n,h;const l=(u==null?void 0:u.id)===((x=s==null?void 0:s.receiver)==null?void 0:x.id)?s==null?void 0:s.user:s==null?void 0:s.receiver;return e.jsx(Y,{to:`/chat/${l==null?void 0:l.slug}`,state:{chat:s.id},children:e.jsx(v,{className:"rounded-none",children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"w-full flex gap-4 items-center",children:[e.jsx("div",{children:e.jsx(g,{size:"lg",shape:"circle",src:`${t}/${((p=l.service)==null?void 0:p.banner)||(l==null?void 0:l.image)}`,icon:e.jsx(w,{})})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center w-full",children:[e.jsx("h4",{className:"text-base",children:((m=l.service)==null?void 0:m.title)||l.username}),e.jsx("p",{className:"text-gray-4b00 font-semibold",children:e.jsx(J,{text:(h=(n=s.messages[((a=s.messages)==null?void 0:a.length)-1])==null?void 0:n.message)==null?void 0:h.replace(/<[^>]*>?/gm,""),maxTextCount:60})})]})]}),e.jsx(Q,{customToggleClass:"flex",placement:"top-end",renderTitle:e.jsx(ie,{icon:e.jsx(C,{className:"text-xl text-gray-600"}),variant:"twoTone",shape:"round"})})]})})},s.id)})})})},oe=()=>{const t=A(),{completingService:d,serviceStatus:u,booking:i}=j(n=>n.requests.data),{completeServiceDialog:s,bookingID:l}=j(n=>n.requests.state),{profile:x}=j(n=>n.auth.user),p=(n,h,o,y)=>{U.push(e.jsx(W,{title:o||"Error",type:h||"warning",duration:y||3e3,children:n}),{placement:"top-center"})};N.useEffect(()=>{u==="error"&&p("Oops! Something went wrong, please try again.","danger","Error",4e3),t(H("idle"))},[u,t]),N.useEffect(()=>{var n,h,o;u==="success"&&(K({app_id:"9749386f-0c3b-417c-b986-3447a73296cd",channel_for_external_user_ids:"push",include_external_user_ids:[`${(n=i==null?void 0:i.user)==null?void 0:n.id}`],url:`${k.appURL}/chat/${x==null?void 0:x.username.toLowerCase()}`,contents:{en:`Hello ${(h=i==null?void 0:i.user)==null?void 0:h.username}, ${x==null?void 0:x.username} has completed your service, please inspect the work and confirm if you are satisfied.`},content_available:!0}),p("We have notified the user that booked this service that it has been completed, please wait a moment for them to confirm.","success","Success",8e3)),t(T(!1)),t(H("idle")),D.emit("completedService",(o=i==null?void 0:i.user)==null?void 0:o.id,console.log("Emit Service Completed, Bookings: ",!0))},[u]);const m=()=>{t(T(!1))},a=()=>{t(Z({booking_id:l}))};return e.jsx(V,{isOpen:s,onClose:m,onRequestClose:m,type:"success",title:"Service Completed?",onCancel:m,onConfirm:a,loading:d,children:e.jsx("p",{children:"Confirm that you have successfully completed this service?"})})},de=()=>{var S;const t=A(),[d,u]=N.useState(0),[i,s]=N.useState(!1),[l,x]=N.useState("");console.log(l);const{confirmingService:p,confirmStatus:m,booking:a}=j(f=>f.requests.data),{confirmServiceDialog:n,bookingID:h}=j(f=>f.requests.state),{profile:o}=j(f=>f.auth.user),y=(f,b,E,$)=>{U.push(e.jsx(W,{title:E||"Error",type:b||"warning",duration:$||3e3,children:f}),{placement:"top-center"})};N.useEffect(()=>{d!==0&&i&&s(!1)},[d,i]),N.useEffect(()=>{m==="error"&&y("Oops! Something went wrong, please try again.","danger","Error",4e3),m==="rating error"&&y("Please kindly leave a rating and try again.","danger","Error",4e3),t(I("idle"))},[m,t]),N.useEffect(()=>{var f,b,E,$,P,L;m==="success"&&(K({app_id:"9749386f-0c3b-417c-b986-3447a73296cd",channel_for_external_user_ids:"push",include_external_user_ids:[`${(b=(f=a==null?void 0:a.service)==null?void 0:f.user)==null?void 0:b.id}`],url:`${k.appURL}/chat/${o==null?void 0:o.username.toLowerCase()}`,contents:{en:`Hello ${($=(E=a==null?void 0:a.service)==null?void 0:E.user)==null?void 0:$.username}, ${o==null?void 0:o.username} has confirmed the completion of this service, we have released the payment to your Taskitly account.`},content_available:!0}),y("Service completed and closed successfully.","success","Success",8e3)),t(z(!1)),t(R(null)),D.emit("confirmedService",(L=(P=a==null?void 0:a.service)==null?void 0:P.user)==null?void 0:L.id),t(G()),t(I("idle"))},[m]);const _=()=>{if(d===0){s(!0);return}t(X({booking_id:h,rating:d,comment:l}))},B=f=>{var b;x((b=f.target)==null?void 0:b.value)},c=()=>{t(z(!1)),t(R(null))};return e.jsxs(F,{isOpen:n,onClose:c,onRequestClose:c,type:"success",title:"Are You Satisfied With This Service?",onCancel:c,onConfirm:_,loading:p,children:[e.jsx("h4",{className:"text-lg font-bold text-gray-700",children:"You are about to release payment"}),e.jsxs("p",{className:"text-base mt-4 text-gray-700",children:["By clicking on ",e.jsx("i",{children:'"Confirm"'}),", it means the service provider has completed their task for you, and you consider the service rendered."]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-700 mt-4",children:["Kindly help us rate ",(S=a==null?void 0:a.service)==null?void 0:S.title," and leave a comment."]}),e.jsxs("div",{children:[e.jsx(ae,{style:{maxWidth:250},value:d,onChange:u}),i&&e.jsx(M.p,{initial:{opacity:0,visibility:"hidden"},animate:{opacity:1,visibility:"visible"},transition:{duration:.3,type:"tween"},exit:{opacity:0,visibility:"hidden"},className:"text-xs text-red-500 mt-2",children:"Please kindly rate this service"})]}),e.jsx(le,{className:"w-full block text-sm outline-none p-3 bg-gray-100 overflow-auto resize-none rounded-md border-0 active:border-0",onChange:B,value:l,placeholder:"Your comment on the service provider and the service they rendered.",maxRows:10,minRows:5}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-700 italic",children:"Only Taskitly team can see this comment, it is not published to the general public."}),e.jsx("p",{className:"text-xs text-red-500 italic",children:"This is to help us ensure proper service providers are on the platform."})]}),e.jsxs("div",{className:"flex items-center gap-4 w-full justify-end",children:[e.jsx(O,{className:"!bg-white",onClick:c,children:"Cancel"}),e.jsx(O,{variant:"solid",onClick:_,loading:p,children:"Confirm"})]})]})]})};q("requests",te);const je=()=>{const t=A(),{imagePath:d}=k,{bookings:u,booking:i,completingService:s,confirmingService:l}=j(c=>c.requests.data),{bookingID:x}=j(c=>c.requests.state),{userType:p,profile:m}=j(c=>c.auth.user),a=p==="Provider",{loading:n,serviceCompleted:h,serviceConfirmed:o}=j(c=>{var S;return(S=c.requests)==null?void 0:S.data});window.OneSignal=window.OneSignal||[];const y=window.OneSignal;y.push(()=>{y.init({appId:"9749386f-0c3b-417c-b986-3447a73296cd",safari_web_id:"web.onesignal.auto.4d0b3421-6847-4c4b-a531-b4bcf634e4d8",allowLocalhostAsSecureOrigin:!0,autoResubscribe:!0})}),N.useEffect(()=>{(h||o)&&t(G()),h?t(ee(!1)):o&&t(se(!1))},[t,h,o]);const _=c=>{t(T(!0)),t(R(c==null?void 0:c.id))},B=c=>{t(z(!0)),t(R(c==null?void 0:c.id))};return e.jsxs("div",{className:"mt-2 p-4",children:[n?e.jsx(ne,{}):e.jsxs("div",{children:[e.jsx("h4",{children:"Active Bookings"}),e.jsx("div",{className:"mt-4 mb-4",children:e.jsx(ce,{imagePath:d,bookings:u,booking:i,completingService:s,confirmingService:l,bookingID:x,isProvider:a,onComplete:_,onConfirm:B})}),e.jsx("h4",{children:"Enquiries"}),e.jsx("div",{className:"min-h-[50vh]",children:e.jsx(re,{})})]}),e.jsx("div",{className:"sticky bottom-24 flex justify-end mr-5",children:e.jsx(Y,{to:"history",children:e.jsx(O,{variant:"solid",children:"Booking History"})})}),e.jsx(oe,{socket:D.current}),e.jsx(de,{socket:D.current})]})};export{je as default};
