import{r as S,aD as K,aE as E,aF as C,h as R,d9 as Z,da as J,dc as W,aI as I,i as Q,c as X,k as ee,l as $,aJ as v,dd as se,j as e,w as ae,F as te,o as ne,p as oe,q as B,t as T,I as ie,de as le,cZ as re,df as P,dg as w,y as k,aL as y,n as ce,M as de,ap as ue,u as q,bw as pe,dh as he,b as ge,di as me,D as xe,dj as be,W as je,E as fe,dk as ye,L as ve}from"./index-43834327.js";import{P as Ne}from"./bundle-3f42fdda.js";function Se(s){const[a,t]=S.useState(!1);return S.useEffect(()=>{Array.isArray(s)&&s.length>0||s&&Object.keys(s).length>0?t(!0):t(!1)},[s]),{hasData:a}}const p="data",Pe=K(),M=E(Z,`${p}/data/getOperators`),ke=E(J,`${p}/data/getProducts`),De=E(W,`${p}/data/buyData`),L=Pe.getInitialState({operators:{...C},products:{...C},bundle:{...C},store:null,pin:"",operator:null,product:null}),G=R({name:`${p}/data`,initialState:L,reducers:{setStore:(s,a)=>{s.store=a.payload===0?null:a.payload},setPin:(s,{payload:a})=>{s.pin=a},setProduct:(s,a)=>{s.product=a.payload===0?null:a.payload},setOperator:(s,a)=>{s.operator=a.payload===0?null:a.payload},resetState:(s,a)=>{const i={user:()=>{s.user=L.user}}[a.payload];i&&i()}},extraReducers:s=>{I(s,M,"operators","data"),I(s,ke,"products","data"),I(s,De,"bundle","data")}}),{setStore:z,resetState:ze,setOperator:Ye,setPin:Ue,setProduct:Ce}=G.actions,Ie=G.reducer,Ee={state:{state:!1,steps:0},kycDialog:!1,pinDialog:!1,query:{search:""}},Y=R({name:`${p}/state`,initialState:Ee,reducers:{setState:(s,{payload:a})=>{s.state.state=a!==0,s.state.steps=a===0?0:a},setSearch:(s,{payload:a})=>{s.query.search=a},toggleKycDialog:(s,{payload:a})=>{s.kycDialog=a},togglePinDialog:(s,{payload:a})=>{s.pinDialog=a}}}),{setState:D,setSearch:Ve,toggleKycDialog:He,togglePinDialog:N}=Y.actions,Ae=Y.reducer,Oe=Q({state:Ae,data:Ie}),x=X,Fe=ee().shape({phone:$().matches(/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,"Phone number is not valid").required("Please enter your phone number"),bundle:$().required("Please select bundle")}),_e=()=>{const s=v(),{product:a,store:t}=x(c=>c[p].data),{profile:i}=x(c=>c.auth.user),{isFetching:o,data:u}=se(t),{products:l}=u||{};console.log(l);const g={phone:(a==null?void 0:a.phone)||""},b=({phone:c,bundle:h})=>{var j,f,m;const d=(j=l==null?void 0:l.data)==null?void 0:j.find(r=>r.id===h);if(((f=d==null?void 0:d.meta)==null?void 0:f.fee)>(i==null?void 0:i.balance)){y("Error","You do not have enough balance to complete this transaction, please top-up and try again.","danger",5e3);return}s(Ce({productID:h,bill:t==null?void 0:t.bill,operatorID:t==null?void 0:t.operatorID,device_number:c,amount:Number((m=d==null?void 0:d.meta)==null?void 0:m.fee),package:d==null?void 0:d.name})),s(D(1))};return e.jsx("div",{className:"mt-5",children:e.jsx(ae.div,{initial:{opacity:0,visibility:"hidden"},animate:{opacity:1,visibility:"visible"},transition:{duration:.3,type:"tween"},exit:{opacity:0,visibility:"hidden"},children:e.jsx(te,{initialValues:g,validationSchema:Fe,onSubmit:c=>b(c),children:({touched:c,errors:h,values:d})=>e.jsx(ne,{children:e.jsxs(oe,{children:[e.jsx(B,{label:"Enter Your Phone Number",invalid:h.phone&&c.phone,errorMessage:h.phone,children:e.jsx(T,{type:"text",autoComplete:"off",name:"phone",placeholder:"Phone number",component:ie,prefix:e.jsx(le,{className:"text-xl"})})}),o?e.jsx(re,{size:40,className:"mx-auto mb-4"}):e.jsx(B,{label:"Select a data bundle",invalid:h.bundle&&c.bundle,errorMessage:h.bundle,children:e.jsx(T,{name:"bundle",children:({field:j,form:f})=>{var m;return e.jsx(P,{className:"grid grid-cols-card gap-3",value:[j.value],onChange:r=>f.setFieldValue(j.name,r[0]),children:e.jsx(e.Fragment,{children:(m=l==null?void 0:l.data)==null?void 0:m.filter(r=>r.fee_type!=="RANGE").map(r=>e.jsx(P.Item,{value:r.id,children:({ref:n,active:U,value:qe,onSegmentItemClick:V,disabled:H})=>{var A,O,F,_;return e.jsx(w,{ref:n,active:U,disabled:H,className:"bg-slate-50",onSegmentItemClick:V,variant:"plain",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx("h6",{children:(A=r==null?void 0:r.meta)==null?void 0:A.data_value}),e.jsx("p",{children:(O=r==null?void 0:r.meta)==null?void 0:O.data_expiry}),e.jsxs("p",{children:["₦",(_=Number((F=r==null?void 0:r.meta)==null?void 0:F.fee))==null?void 0:_.toLocaleString()]})]})})}},r.id))})})}})}),e.jsx(k,{variant:"solid",type:"submit",block:!0,className:"!bg-gray-900 hover:!bg-black",disabled:!d.bundle||!d.phone||o,children:"Continue"})]})})})})})},$e=({operators:s})=>{var i;const a=v(),t={Airtel:"/img/airtel.jpg","9Mobile":"/img/9mobile.png",Glo:"/img/Glo.png",MTN:"/img/MTN.png"};return console.log(s),e.jsx(P,{className:"flex flex-col xx:grid xx:grid-cols-4 gap-3",onChange:o=>{a(z({operatorID:o[0],bill:"telco"}))},children:(i=s==null?void 0:s.data)==null?void 0:i.filter(o=>o.name!=="Visafone").map(o=>e.jsx(P.Item,{value:o.id,children:({ref:u,active:l,value:g,onSegmentItemClick:b,disabled:c})=>e.jsx(w,{ref:u,active:l,disabled:c,className:ce("bg-slate-50",l&&"bg-sky-100"),onSegmentItemClick:b,variant:"plain",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(de,{size:"lg",src:t[o.name],icon:e.jsx(ue,{})}),e.jsx("h6",{children:o==null?void 0:o.name})]})})},o.id))})},Be=()=>{var u;const s=v(),a=q(),{product:t}=x(l=>l[p].data),{hasPin:i}=x(l=>l.auth.user),o=()=>{i?s(N(!0)):a("/transaction-pin")};return e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base mb-2",children:"Your Order"}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Bundle:"}),e.jsx("p",{className:"text-sm font-semibold",children:t==null?void 0:t.package})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Phone Number:"}),e.jsx("p",{className:"text-sm font-semibold",children:t==null?void 0:t.device_number})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Bundle Cost:"}),e.jsx("p",{className:"text-sm font-semibold",children:`₦${(u=t==null?void 0:t.amount)==null?void 0:u.toLocaleString()}`})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-8",children:[e.jsx(k,{block:!0,variant:"solid",color:"red-500",icon:e.jsx(pe,{}),className:"",onClick:()=>s(D(0)),children:"Back"}),e.jsx(k,{block:!0,variant:"solid",icon:e.jsx(he,{}),className:"!bg-gray-900 hover:!bg-black",onClick:o,children:"Confirm"})]})]}),e.jsx(Re,{})]})},Te={padding:void 0,margin:void 0,textAlign:void 0,border:void 0,background:void 0,width:void 0,height:void 0},Le={outline:void 0,boxShadow:void 0},Re=()=>{const s=v(),a=q(),t=ge(),[i,o]=S.useState("");let u;const{product:l}=x(n=>n[p].data),{pinDialog:g}=x(n=>n[p].state),b=()=>{s(N(!1))},c=()=>{s(N(!1)),s(D(0))},h=()=>{t.pathname!=="/profile/kyb"&&a("/profile/kyb")},d=()=>{u==null||u.clear(),o("")},j=()=>{const n={pin:i,...l};f(n)},{mutate:f,isLoading:m,error:r}=me(n=>{console.log("error block",n),n.response.data.status==="pin error"?y(n.response.data.message,"The PIN entered does not match your transaction PIN, please try again.","danger",5e3):n.response.status===422?(y(n.response.data.status,n.response.data.message,"danger",5e3),c(),h()):(y("Error",n.response.data.message??"Oops! Something went wrong, please try again.","danger",5e3),c()),d(),b()},n=>{console.log("Success block",n),y("Success",n.message??"Transaction completed successfully.","success",5e3),d(),s(N(!1)),s(je()),s(D(0)),s(z(0))});return e.jsxs(xe,{isOpen:g,onClose:b,onRequestClose:b,shouldCloseOnOverlayClick:!1,shouldCloseOnEsc:!1,contentClassName:"mt-[30vh]",title:"Require PIN",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-700",children:"Authorize Transaction"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm mb-2",children:"Please enter your transaction pin to authorize this transaction"}),e.jsx("div",{children:e.jsx(Ne,{length:6,initialValue:"",secretDelay:200,ref:n=>u=n,onChange:n=>{o(n)},type:"numeric",inputMode:"number",inputStyle:Te,inputFocusStyle:Le,autoSelect:!0,regexCriteria:/^[ A-Za-z0-9_@./#&+-]*$/})}),e.jsx(k,{block:!0,variant:"solid",className:"!bg-gray-900 hover:!bg-black mt-6",icon:e.jsx(be,{}),loading:m,disabled:!i||(i==null?void 0:i.length)<6||m,onClick:j,children:"Authorize"})]})]})};fe(`${p}`,Oe);const we=()=>{const s=v(),{state:a}=x(g=>g[p].state),{products:t,store:i}=x(g=>g[p].data),{data:o,isFetching:u}=ye("telco"),{operators:l}=o||{};return Se(t.data),S.useEffect(()=>{s(M())},[]),e.jsx("div",{className:"p-4 mt-2",children:e.jsx(ve,{loading:u,children:a.state?e.jsx(e.Fragment,{children:a.steps===1&&e.jsx(Be,{})}):e.jsxs(e.Fragment,{children:[e.jsx($e,{operators:l}),i&&e.jsx(_e,{})]})})})},Ke=we;export{Ke as default};
