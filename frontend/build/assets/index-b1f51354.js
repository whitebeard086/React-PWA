import{f as B,g as E,bA as R,j as e,q as i,J as f,af as j,S as t,x as k,a as N,n as h,H as S,r as b,bB as C,b1 as D,bs as z,V as A,W as P,bC as I,y as q,bD as F,bE as L,bF as U}from"./index-508e130b.js";import{B as H}from"./index-58494b0e.js";import{B as O}from"./BillsComponent-725fc7de.js";import{s as V}from"./sendPushNotification-2a35c3f5.js";import"./index.esm-985d0e24.js";const _=B({name:"dashboard/state",initialState:{completeServiceDialog:!1,completeService:!1,confirmServiceDialog:!1,confirmService:!1,bookingID:null},reducers:{setBookingID:(s,c)=>{s.bookingID=c.payload},setConfirmService:(s,c)=>{s.confirmService=c.payload},setCompleteService:(s,c)=>{s.completeService=c.payload},toggleCompleteServiceDialog:(s,c)=>{s.completeServiceDialog=c.payload},toggleConfirmServiceDialog:(s,c)=>{s.confirmServiceDialog=c.payload}}}),{setBookingID:W,setConfirmService:te,setCompleteService:ce,toggleConfirmServiceDialog:ae,toggleCompleteServiceDialog:y}=_.actions,G=_.reducer,J=E({state:G,data:R}),T=()=>e.jsxs("div",{children:[e.jsx("h4",{children:"Active Bookings"}),e.jsxs("div",{className:"mt-4 mb-4 flex gap-4 overflow-auto pb-4",children:[e.jsx(i,{className:"min-w-[18rem] w-80",bodyClass:"flex w-full flex-col justify-center items-center",children:e.jsxs("div",{className:"w-full flex items-center gap-4",children:[e.jsxs("div",{className:"w-1/2 flex flex-col items-center",children:[e.jsx(f,{size:"lg",shape:"circle",icon:e.jsx(j,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(t,{width:"80%"}),e.jsx(t,{width:"100%"})]})]}),e.jsx(t,{width:"50%",height:"30px"})]})}),e.jsx(i,{className:"min-w-[18rem] w-80",bodyClass:"flex w-full flex-col justify-center items-center",children:e.jsxs("div",{className:"w-full flex items-center gap-4",children:[e.jsxs("div",{className:"w-1/2 flex flex-col items-center",children:[e.jsx(f,{size:"lg",shape:"circle",icon:e.jsx(j,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(t,{width:"80%"}),e.jsx(t,{width:"100%"})]})]}),e.jsx(t,{width:"50%",height:"30px"})]})}),e.jsx(i,{className:"min-w-[18rem] w-80",bodyClass:"flex w-full flex-col justify-center items-center",children:e.jsxs("div",{className:"w-full flex items-center gap-4",children:[e.jsxs("div",{className:"w-1/2 flex flex-col items-center",children:[e.jsx(f,{size:"lg",shape:"circle",icon:e.jsx(j,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(t,{width:"80%"}),e.jsx(t,{width:"100%"})]})]}),e.jsx(t,{width:"50%",height:"30px"})]})})]}),e.jsx("h4",{children:"Unanswered Request Chats"}),e.jsxs("div",{className:"mt-4 mb-4 flex gap-4 overflow-auto pb-4",children:[e.jsxs(i,{className:"min-w-[10rem] w-40",bodyClass:"flex w-full flex-col justify-center items-center",children:[e.jsx(f,{size:"lg",shape:"circle",icon:e.jsx(j,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(t,{width:"80%"}),e.jsx(t,{width:"100%"})]})]}),e.jsxs(i,{className:"min-w-[10rem] w-40",bodyClass:"flex w-full flex-col justify-center items-center",children:[e.jsx(f,{size:"lg",shape:"circle",icon:e.jsx(j,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(t,{width:"80%"}),e.jsx(t,{width:"100%"})]})]}),e.jsxs(i,{className:"min-w-[10rem] w-40",bodyClass:"flex w-full flex-col justify-center items-center",children:[e.jsx(f,{size:"lg",shape:"circle",icon:e.jsx(j,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(t,{width:"80%"}),e.jsx(t,{width:"100%"})]})]}),e.jsxs(i,{className:"min-w-[10rem] w-40",bodyClass:"flex w-full flex-col justify-center items-center",children:[e.jsx(f,{size:"lg",shape:"circle",icon:e.jsx(j,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(t,{width:"80%"}),e.jsx(t,{width:"100%"})]})]})]}),e.jsxs("div",{className:"mt-4 mb-4 w-full flex items-center gap-4 overflow-auto pb-4",children:[e.jsx(i,{className:"w-1/2 min-w-[18rem] h-40",bodyClass:"h-full",children:e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 justify-center items-center",children:[e.jsx("h4",{children:"All Profile Views"}),e.jsx(t,{width:"30%",height:"15px"})]})}),e.jsx(i,{className:"w-1/2 min-w-[18rem] h-40",bodyClass:"h-full",children:e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 justify-center items-center",children:[e.jsx("h4",{children:"All Service Requests"}),e.jsx(t,{width:"30%",height:"15px"})]})})]}),e.jsx("div",{className:"col-span-4 w-full mt-4",children:e.jsx(i,{className:"bg-black",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold mb-2 text-white",children:"Bill Payments"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx(i,{bordered:!0,bodyClass:"p-0",className:"p-0",children:e.jsx(t,{height:"60px"})}),e.jsx(i,{bordered:!0,bodyClass:"p-0",className:"p-0",children:e.jsx(t,{height:"60px"})}),e.jsx(i,{bordered:!0,bodyClass:"p-0",className:"p-0",children:e.jsx(t,{height:"60px"})}),e.jsx(i,{bordered:!0,bodyClass:"p-0",className:"p-0",children:e.jsx(t,{height:"60px"})}),e.jsx(i,{bordered:!0,bodyClass:"p-0",className:"p-0",children:e.jsx(t,{height:"60px"})}),e.jsx(i,{bordered:!0,bodyClass:"p-0",className:"p-0",children:e.jsx(t,{height:"60px"})}),e.jsx(i,{bordered:!0,bodyClass:"p-0",className:"p-0",children:e.jsx(t,{height:"60px"})}),e.jsx(i,{bordered:!0,bodyClass:"p-0",className:"p-0",children:e.jsx(t,{height:"60px"})})]})]})})})]}),Y=({data:s,imagePath:c})=>{const a=s==null?void 0:s.filter(l=>{var o;return((o=l.messages)==null?void 0:o.length)>0});return e.jsx(e.Fragment,{children:(a==null?void 0:a.length)<1?e.jsx("div",{className:"min-h-[20vh] w-full flex flex-col justify-center",children:e.jsxs("p",{className:"text-center text-gray-400 font-bold text-2xl",children:["You don't have ",e.jsx("br",{})," any unanswered chats..."]})}):e.jsx(e.Fragment,{children:a==null?void 0:a.map(l=>{var o,r,d,u,m;return e.jsx(k,{to:`/chat/${(o=l.user)==null?void 0:o.slug}`,state:{chat:l.id},children:e.jsxs(i,{className:"min-w-[10rem] w-40",bodyClass:"flex w-full flex-col justify-center items-center",children:[e.jsx(f,{size:"lg",shape:"circle",icon:e.jsx(j,{}),src:(r=l.user)!=null&&r.image?`${c}/${(d=l.user)==null?void 0:d.image}`:null}),e.jsx("h4",{className:"font-semibold text-base",children:`${(u=l==null?void 0:l.user)==null?void 0:u.first_name} ${(m=l==null?void 0:l.user)==null?void 0:m.last_name}`})]})},l.id)})})})},K=({bookingsCount:s,profile:c})=>{var a;return e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"w-1/2 min-w-[18rem] h-40",bodyClass:"h-full",children:e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 justify-center items-center",children:[e.jsx("h4",{className:"text-gray-600",children:"All Profile Views"}),e.jsx("h4",{className:"font-semibold",children:(a=c==null?void 0:c.profile_views)==null?void 0:a.toLocaleString()})]})}),e.jsx(i,{className:"w-1/2 min-w-[18rem] h-40",bodyClass:"h-full",children:e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 justify-center items-center",children:[e.jsx("h4",{className:"text-gray-600",children:"All Service Requests"}),e.jsx("h4",{className:"font-semibold",children:s==null?void 0:s.toLocaleString()})]})})]})},M=()=>{const s=N(),{imagePath:c}=S,{enquiries:a,bookings:l,bookingsCount:o,booking:r,completingService:d,confirmingService:u}=h(x=>x.dashboard.data),{bookingID:m}=h(x=>x.dashboard.state),{profile:g,userType:n}=h(x=>x.auth.user),w=n==="Provider",p=a==null?void 0:a.filter(x=>x.messages.every($=>$.sender_id!==(g==null?void 0:g.id)));console.log(p);const v=x=>{s(y(!0)),s(W(x==null?void 0:x.id))};return e.jsxs("div",{children:[e.jsx("h4",{children:"Active Bookings"}),e.jsx("div",{className:"mt-4 mb-4",children:e.jsx(H,{imagePath:c,bookings:l,isProvider:w,booking:r,completingService:d,confirmingService:u,bookingID:m,onComplete:v})}),e.jsx("h4",{children:"Unanswered Request Chats"}),e.jsx("div",{className:"mt-4 mb-4 flex gap-4 overflow-auto pb-4",children:e.jsx(Y,{data:p,imagePath:c})}),e.jsx("div",{className:"mt-4 mb-4 w-full flex items-center gap-4 overflow-auto pb-4",children:e.jsx(K,{bookingsCount:o,profile:g})}),e.jsx(O,{})]})},Q=()=>{const s=N(),{completingService:c,serviceStatus:a,booking:l}=h(n=>n.dashboard.data),{completeServiceDialog:o,bookingID:r}=h(n=>n.dashboard.state),{profile:d}=h(n=>n.auth.user),u=(n,w,p,v)=>{A.push(e.jsx(P,{title:p||"Error",type:w||"warning",duration:v||3e3,children:n}),{placement:"top-center"})};b.useEffect(()=>{a==="error"&&u("Oops! Something went wrong, please try again.","danger","Error",4e3),s(C("idle"))},[a,s]),b.useEffect(()=>{var n,w,p;a==="success"&&(V({app_id:"9749386f-0c3b-417c-b986-3447a73296cd",channel_for_external_user_ids:"push",include_external_user_ids:[`${(n=l==null?void 0:l.user)==null?void 0:n.id}`],url:`${S.appURL}/chat/${d==null?void 0:d.username.toLowerCase()}`,contents:{en:`Hello ${(w=l==null?void 0:l.user)==null?void 0:w.username}, ${d==null?void 0:d.username} has completed your service, please inspect the work and confirm if you are satisfied.`},content_available:!0}),u("We have notified the user that booked this service that it has been completed, please wait a moment for them to confirm.","success","Success",8e3)),s(y(!1)),s(C("idle")),D.emit("completedService",(p=l==null?void 0:l.user)==null?void 0:p.id,console.log("Emit Service Completed, Dashboard: ",!0))},[a]);const m=()=>{s(y(!1))},g=()=>{s(I({booking_id:r}))};return e.jsx(z,{isOpen:o,onClose:m,onRequestClose:m,type:"success",title:"Service Completed?",onCancel:m,onConfirm:g,loading:c,children:e.jsx("p",{children:"Confirm that you have successfully completed this service?"})})};q("dashboard",J);const ie=()=>{const s=N(),{serviceCompleted:c,serviceConfirmed:a}=h(r=>r.dashboard.data),{serviceBooked:l}=h(r=>r.chat.data),{loading:o}=h(r=>r.dashboard.data);return h(r=>r.auth.user),b.useEffect(()=>{(c||a||l)&&s(F()),c?s(L(!1)):a&&s(U(!1))},[s,c,a,l]),e.jsxs("div",{className:"mt-10 mb-8 px-4",children:[o?e.jsx(T,{}):e.jsx(M,{}),e.jsx(Q,{socket:D.current})]})};export{ie as default};
