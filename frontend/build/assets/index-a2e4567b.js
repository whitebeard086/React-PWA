import{aD as K,aE as $,aF as L,h as B,dm as H,dd as Z,aI as R,i as J,c as W,k as Q,l as X,aJ as y,r as I,j as e,L as P,dn as ee,F as se,o as ae,p as te,q as ne,t as ce,Z as ie,c_ as re,A as oe,y as k,dg as C,dh as V,n as le,O as de,ap as ue,u as q,bw as me,di as ge,de as he,aL as S,b as pe,dj as xe,D as be,dk as je,W as ve,E as fe,dl as Se}from"./index-2cc994c4.js";import{d as ye}from"./debounce-5e45d45e.js";import{P as Ne}from"./bundle-d6c1a986.js";const g="cable",ke=K(),z=$(H,`${g}/data/verifyCustomer`),Ce=$(Z,`${g}/data/buyData`),w=ke.getInitialState({customer:{...L},store:null,product:null,bundle:{...L}}),U=B({name:`${g}/data`,initialState:w,reducers:{setStore:(s,t)=>{s.store=t.payload===0?null:t.payload},setProduct:(s,t)=>{s.product=t.payload===0?null:t.payload},resetState:(s,t)=>{const l={user:()=>{s.user=w.user}}[t.payload];l&&l()}},extraReducers:s=>{R(s,z,"customer","customer"),R(s,Ce,"bundle","data")}}),{setStore:Y,resetState:Ue,setProduct:M}=U.actions,De=U.reducer,Ie={state:{state:!1,steps:0},kycDialog:!1,pinDialog:!1,query:{search:""}},G=B({name:`${g}/state`,initialState:Ie,reducers:{setState:(s,{payload:t})=>{s.state.state=t!==0,s.state.steps=t===0?0:t},setSearch:(s,{payload:t})=>{s.query.search=t},toggleKycDialog:(s,{payload:t})=>{s.kycDialog=t},togglePinDialog:(s,{payload:t})=>{s.pinDialog=t}}}),{setState:f,setSearch:Ye,toggleKycDialog:Me,togglePinDialog:N}=G.actions,Pe=G.reducer,_e=J({state:Pe,data:De}),p=W,Fe=Q().shape({device_number:X().required("Please enter meter number")}),Ae={device_number:""},Ee=()=>{const s=y(),{store:t,customer:a,product:l}=p(n=>n[g].data),o=n=>{s(z(n))},r=I.useRef(ye(o,1e3)).current;I.useEffect(()=>()=>{r.cancel()},[]);const d=n=>{r(n)},c=n=>{s(M({...l,...n})),s(f(2))};return e.jsxs(P,{loading:!1,children:[e.jsxs("div",{className:"inline-flex items-center cursor-pointer py-2 pr-2 mb-2",onClick:()=>{s(f(0))},children:[e.jsx(ee,{})," Back"]}),e.jsx(se,{initialValues:Ae,validationSchema:Fe,onSubmit:n=>c(n),children:({touched:n,errors:u,values:m})=>{var h,x,j,b,v,i,_,F,A;return e.jsx(ae,{children:e.jsxs(te,{children:[e.jsx(ne,{label:"Smart card number",invalid:u.device_number&&n.device_number,errorMessage:u.device_number,className:"xx:flex-1 xx:justify-between",children:e.jsx(ce,{name:"device_number",children:({field:E,form:O})=>e.jsx(ie,{className:"xx:h-12",form:O,field:E,placeholder:"Smart card number",format:"###",onValueChange:D=>{if(O.setFieldValue(E.name,D.value),D.value.length>=11){const T={...t,device_number:D.value};console.log(T),d(T)}}})})}),((h=m==null?void 0:m.device_number)==null?void 0:h.length)>10&&e.jsx(e.Fragment,{children:(a==null?void 0:a.status)==="pending"?e.jsx(re,{size:35,className:"mx-auto mb-3"}):e.jsx(e.Fragment,{children:((a==null?void 0:a.status)==="success"||(a==null?void 0:a.status)==="error")&&e.jsx(oe,{className:"mb-4",type:(x=a==null?void 0:a.data)!=null&&x.success&&((b=(j=a==null?void 0:a.data)==null?void 0:j.data)!=null&&b.name)?"success":"danger",showIcon:!0,children:((i=(v=a==null?void 0:a.data)==null?void 0:v.data)==null?void 0:i.name)??(a==null?void 0:a.message)})})}),e.jsx(k,{variant:"solid",type:"submit",block:!0,className:"!bg-gray-900 hover:!bg-black",disabled:!((_=a==null?void 0:a.data)!=null&&_.success)&&!((A=(F=a==null?void 0:a.data)==null?void 0:F.data)!=null&&A.name),children:"Continue"})]})})}})]})},Oe=({operators:s})=>{var l;const t=y(),a={DSTV:"/img/dstv.png",GOTV:"/img/gotv.png",STARTIMES:"/img/startimes.png"};return e.jsx(C,{className:"flex flex-col xx:grid xx:grid-cols-3 gap-3",onChange:o=>{t(Y({operatorID:o[0],bill:"television"}))},children:(l=s==null?void 0:s.data)==null?void 0:l.map((o,r)=>e.jsx(C.Item,{value:o.id,children:({ref:d,active:c,value:n,onSegmentItemClick:u,disabled:m})=>e.jsx(V,{ref:d,active:c,disabled:m,className:le("bg-slate-50",c&&"bg-sky-100"),onSegmentItemClick:u,variant:"plain",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(de,{size:"lg",src:a[o.name],icon:e.jsx(ue,{})}),e.jsx("h6",{children:o==null?void 0:o.name})]})})},o.id))})},Te=()=>{var r;const s=y(),t=q(),{product:a}=p(d=>d[g].data),{hasPin:l}=p(d=>d.auth.user),o=()=>{l?s(N(!0)):t("/transaction-pin")};return e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base mb-2",children:"Your Order"}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Package:"}),e.jsx("p",{className:"text-sm font-semibold",children:a==null?void 0:a.package})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Smart Card Number:"}),e.jsx("p",{className:"text-sm font-semibold",children:a==null?void 0:a.device_number})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Subscription Cost:"}),e.jsx("p",{className:"text-sm font-semibold",children:`₦${(r=Number(a==null?void 0:a.amount))==null?void 0:r.toLocaleString()}`})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-8",children:[e.jsx(k,{block:!0,variant:"solid",color:"red-500",icon:e.jsx(me,{}),className:"",onClick:()=>s(f(1)),children:"Back"}),e.jsx(k,{block:!0,variant:"solid",icon:e.jsx(ge,{}),className:"!bg-gray-900 hover:!bg-black",onClick:o,children:"Confirm"})]})]}),e.jsx($e,{})]})},Le=()=>{var d;const{store:s}=p(c=>c[g].data),{profile:t}=p(c=>c.auth.user),a=y(),{isFetching:l,data:o}=he(s),{products:r}=o||{};return e.jsx(P,{loading:l,children:e.jsx(C,{className:"grid grid-cols-pow gap-3",onChange:c=>{var u,m,h;const n=(u=r==null?void 0:r.data)==null?void 0:u.find(x=>x.id===c[0]);if(((m=n==null?void 0:n.meta)==null?void 0:m.fee)>(t==null?void 0:t.account_balance)){S("Error","You do not have enough balance to complete this transaction, please top-up and try again.","danger",5e3);return}a(M({productID:c[0],bill:"television",operatorID:s==null?void 0:s.operatorID,amount:Number((h=n==null?void 0:n.meta)==null?void 0:h.fee),package:n==null?void 0:n.name})),a(f(1))},children:(d=r==null?void 0:r.data)==null?void 0:d.map((c,n)=>e.jsx(C.Item,{value:c.id,children:({ref:u,active:m,value:h,onSegmentItemClick:x,disabled:j})=>{var b,v;return e.jsx(V,{ref:u,active:m,disabled:j,className:"bg-slate-50",onSegmentItemClick:x,variant:"plain",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx("p",{children:c==null?void 0:c.name}),e.jsxs("h6",{children:["₦",(v=Number((b=c==null?void 0:c.meta)==null?void 0:b.fee))==null?void 0:v.toLocaleString()]})]})})}},c.id))})})},Re={padding:void 0,margin:void 0,textAlign:void 0,border:void 0,background:void 0,width:void 0,height:void 0},we={outline:void 0,boxShadow:void 0},$e=()=>{const s=y(),t=q(),a=pe(),[l,o]=I.useState("");let r;const{product:d}=p(i=>i[g].data),{pinDialog:c}=p(i=>i[g].state),n=()=>{s(N(!1))},u=()=>{s(N(!1)),s(f(0))},m=()=>{a.pathname!=="/profile/kyb"&&t("/profile/kyb")},h=()=>{r==null||r.clear(),o("")},x=()=>{const i={pin:l,...d};j(i)},{mutate:j,isLoading:b,error:v}=xe(i=>{console.log("error block",i),i.response.data.status==="pin error"?S(i.response.data.message,"The PIN entered does not match your transaction PIN, please try again.","danger",5e3):i.response.status===422?(S(i.response.data.status,i.response.data.message,"danger",5e3),u(),m()):(S("Error",i.response.data.message??"Oops! Something went wrong, please try again.","danger",5e3),u()),h(),n()},i=>{console.log("Success block",i),S("Success",i.message??"Transaction completed successfully.","success",5e3),h(),s(N(!1)),s(ve()),s(f(0)),s(Y(0))});return e.jsxs(be,{isOpen:c,onClose:n,onRequestClose:n,shouldCloseOnOverlayClick:!1,shouldCloseOnEsc:!1,contentClassName:"mt-[30vh]",title:"Require PIN",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-700",children:"Authorize Transaction"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm mb-2",children:"Please enter your pin to authorize this transaction"}),e.jsx("div",{children:e.jsx(Ne,{length:6,initialValue:"",secretDelay:200,ref:i=>r=i,onChange:i=>{o(i)},type:"numeric",inputMode:"number",inputStyle:Re,inputFocusStyle:we,autoSelect:!0,regexCriteria:/^[ A-Za-z0-9_@./#&+-]*$/})}),e.jsx(k,{block:!0,variant:"solid",className:"!bg-gray-900 hover:!bg-black mt-6",icon:e.jsx(je,{}),loading:b,disabled:!l||(l==null?void 0:l.length)<6||b,onClick:x,children:"Authorize"})]})]})};fe(`${g}`,_e);const Be=()=>{const{state:s}=p(c=>c[g].state),{store:t,product:a,customer:l}=p(c=>c[g].data),{data:o,isFetching:r}=Se("television"),{operators:d}=o||{};return console.log("State: ",s),console.log("Store: ",t),e.jsx("div",{className:"p-4 mt-2",children:e.jsx(P,{loading:r,children:s.state?e.jsxs(e.Fragment,{children:[s.steps===1&&e.jsx(Ee,{}),s.steps===2&&e.jsx(Te,{})]}):e.jsxs("div",{className:"grid gap-4",children:[e.jsx(Oe,{operators:d}),t&&e.jsx(Le,{})]})})})},Ge=Be;export{Ge as default};
