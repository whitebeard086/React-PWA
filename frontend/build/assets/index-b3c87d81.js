import{f as U,g as W,bo as V,j as e,q as v,J as g,af as w,S as n,bp as S,n as f,x as z,bq as q,aD as G,H as _,a as B,r as N,br as R,b1 as y,bs as T,V as I,W as L,bt as J,bu as k,bv as A,bw as Y,y as F,bx as K,by as M,w as Q}from"./index-508e130b.js";import{E as X}from"./EllipsisButton-114ba44a.js";import{s as H}from"./sendPushNotification-2a35c3f5.js";import{B as Z}from"./index-58494b0e.js";const P=U({name:"requests/state",initialState:{completeServiceDialog:!1,completeService:!1,confirmServiceDialog:!1,confirmService:!1,bookingID:null},reducers:{setBookingID:(s,l)=>{s.bookingID=l.payload},setConfirmService:(s,l)=>{s.confirmService=l.payload},setCompleteService:(s,l)=>{s.completeService=l.payload},toggleCompleteServiceDialog:(s,l)=>{s.completeServiceDialog=l.payload},toggleConfirmServiceDialog:(s,l)=>{s.confirmServiceDialog=l.payload}}}),{setBookingID:D,setConfirmService:de,setCompleteService:xe,toggleConfirmServiceDialog:E,toggleCompleteServiceDialog:$}=P.actions,ee=P.reducer,se=W({state:ee,data:V}),te=()=>e.jsxs("div",{children:[e.jsx("h4",{children:"Active Bookings"}),e.jsxs("div",{className:"mt-4 mb-4 flex gap-4 overflow-auto pb-4",children:[e.jsxs(v,{className:"min-w-[10rem] w-40",bodyClass:"flex w-full flex-col justify-center items-center",children:[e.jsx(g,{size:"lg",shape:"circle",icon:e.jsx(w,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(n,{width:"80%"}),e.jsx(n,{width:"100%"})]})]}),e.jsxs(v,{className:"min-w-[10rem] w-40",bodyClass:"flex w-full flex-col justify-center items-center",children:[e.jsx(g,{size:"lg",shape:"circle",icon:e.jsx(w,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(n,{width:"80%"}),e.jsx(n,{width:"100%"})]})]}),e.jsx(v,{className:"min-w-[18rem] w-80",bodyClass:"flex w-full flex-col justify-center items-center",children:e.jsxs("div",{className:"w-full flex items-center gap-4",children:[e.jsxs("div",{className:"w-1/2 flex flex-col items-center",children:[e.jsx(g,{size:"lg",shape:"circle",icon:e.jsx(w,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(n,{width:"80%"}),e.jsx(n,{width:"100%"})]})]}),e.jsx(n,{width:"50%",height:"30px"})]})})]}),e.jsx("h4",{children:"Enquiries"}),e.jsxs("div",{className:"mt-4",children:[e.jsx(v,{className:"rounded-none",children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"w-full flex gap-4 items-center",children:[e.jsx("div",{children:e.jsx(g,{size:"lg",shape:"circle",icon:e.jsx(w,{})})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center w-full",children:[e.jsx(n,{width:"40%"}),e.jsx(n,{width:"60%"})]})]}),e.jsx(S,{className:"text-xl"})]})}),e.jsx(v,{className:"rounded-none",children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"w-full flex gap-4 items-center",children:[e.jsx("div",{children:e.jsx(g,{size:"lg",shape:"circle",icon:e.jsx(w,{})})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center w-full",children:[e.jsx(n,{width:"40%"}),e.jsx(n,{width:"60%"})]})]}),e.jsx(S,{className:"text-xl"})]})}),e.jsx(v,{className:"rounded-none",children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"w-full flex gap-4 items-center",children:[e.jsx("div",{children:e.jsx(g,{size:"lg",shape:"circle",icon:e.jsx(w,{})})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center w-full",children:[e.jsx(n,{width:"40%"}),e.jsx(n,{width:"60%"})]})]}),e.jsx(S,{className:"text-xl"})]})}),e.jsx(v,{className:"rounded-none",children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"w-full flex gap-4 items-center",children:[e.jsx("div",{children:e.jsx(g,{size:"lg",shape:"circle",icon:e.jsx(w,{})})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center w-full",children:[e.jsx(n,{width:"40%"}),e.jsx(n,{width:"60%"})]})]}),e.jsx(S,{className:"text-xl"})]})}),e.jsx(v,{className:"rounded-none",children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"w-full flex gap-4 items-center",children:[e.jsx("div",{children:e.jsx(g,{size:"lg",shape:"circle",icon:e.jsx(w,{})})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center w-full",children:[e.jsx(n,{width:"40%"}),e.jsx(n,{width:"60%"})]})]}),e.jsx(S,{className:"text-xl"})]})})]})]}),ie=()=>{const{imagePath:s}=_,{enquiries:l}=f(i=>i.requests.data),{profile:d}=f(i=>i.auth.user),t=l==null?void 0:l.filter(i=>{var a;return((a=i==null?void 0:i.messages)==null?void 0:a.length)>0});return e.jsx("div",{className:"mt-4 mb-4",children:(t==null?void 0:t.length)<1?e.jsx("div",{className:"min-h-[20vh] flex flex-col justify-center",children:e.jsxs("p",{className:"text-center text-gray-400 font-bold text-2xl",children:["No enquiries, ",e.jsx("br",{})," check back later..."]})}):e.jsx("div",{children:t==null?void 0:t.map(i=>{var r,u,j,h,c,o;const a=(d==null?void 0:d.id)===((r=i==null?void 0:i.receiver)==null?void 0:r.id)?i==null?void 0:i.user:i==null?void 0:i.receiver;return e.jsx(z,{to:`/chat/${a==null?void 0:a.slug}`,state:{chat:i.id},children:e.jsx(v,{className:"rounded-none",children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"w-full flex gap-4 items-center",children:[e.jsx("div",{children:e.jsx(g,{size:"lg",shape:"circle",src:`${s}/${((u=a.service)==null?void 0:u.banner)||(a==null?void 0:a.image)}`,icon:e.jsx(w,{})})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center w-full",children:[e.jsx("h4",{className:"text-base",children:((j=a.service)==null?void 0:j.title)||a.username}),e.jsx("p",{className:"text-gray-4b00 font-semibold",children:e.jsx(q,{text:(o=(c=i.messages[((h=i.messages)==null?void 0:h.length)-1])==null?void 0:c.message)==null?void 0:o.replace(/<[^>]*>?/gm,""),maxTextCount:60})})]})]}),e.jsx(G,{customToggleClass:"flex",placement:"top-end",renderTitle:e.jsx(X,{icon:e.jsx(S,{className:"text-xl text-gray-600"}),variant:"twoTone",shape:"round"})})]})})},i.id)})})})},ce=()=>{const s=B(),{completingService:l,serviceStatus:d,booking:t}=f(c=>c.requests.data),{completeServiceDialog:i,bookingID:a}=f(c=>c.requests.state),{profile:r}=f(c=>c.auth.user),u=(c,o,m,p)=>{I.push(e.jsx(L,{title:m||"Error",type:o||"warning",duration:p||3e3,children:c}),{placement:"top-center"})};N.useEffect(()=>{d==="error"&&u("Oops! Something went wrong, please try again.","danger","Error",4e3),s(R("idle"))},[d,s]),N.useEffect(()=>{var c,o,m;d==="success"&&(H({app_id:"9749386f-0c3b-417c-b986-3447a73296cd",channel_for_external_user_ids:"push",include_external_user_ids:[`${(c=t==null?void 0:t.user)==null?void 0:c.id}`],url:`${_.appURL}/chat/${r==null?void 0:r.username.toLowerCase()}`,contents:{en:`Hello ${(o=t==null?void 0:t.user)==null?void 0:o.username}, ${r==null?void 0:r.username} has completed your service, please inspect the work and confirm if you are satisfied.`},content_available:!0}),u("We have notified the user that booked this service that it has been completed, please wait a moment for them to confirm.","success","Success",8e3)),s($(!1)),s(R("idle")),y.emit("completedService",(m=t==null?void 0:t.user)==null?void 0:m.id,console.log("Emit Service Completed, Bookings: ",!0))},[d]);const j=()=>{s($(!1))},h=()=>{s(J({booking_id:a}))};return e.jsx(T,{isOpen:i,onClose:j,onRequestClose:j,type:"success",title:"Service Completed?",onCancel:j,onConfirm:h,loading:l,children:e.jsx("p",{children:"Confirm that you have successfully completed this service?"})})},le=()=>{const s=B(),{confirmingService:l,confirmStatus:d,booking:t}=f(c=>c.requests.data),{confirmServiceDialog:i,bookingID:a}=f(c=>c.requests.state),{profile:r}=f(c=>c.auth.user),u=(c,o,m,p)=>{I.push(e.jsx(L,{title:m||"Error",type:o||"warning",duration:p||3e3,children:c}),{placement:"top-center"})};N.useEffect(()=>{d==="error"&&u("Oops! Something went wrong, please try again.","danger","Error",4e3),s(k("idle"))},[d,s]),N.useEffect(()=>{var c,o,m,p,b,C;d==="success"&&(H({app_id:"9749386f-0c3b-417c-b986-3447a73296cd",channel_for_external_user_ids:"push",include_external_user_ids:[`${(o=(c=t==null?void 0:t.service)==null?void 0:c.user)==null?void 0:o.id}`],url:`${_.appURL}/chat/${r==null?void 0:r.username.toLowerCase()}`,contents:{en:`Hello ${(p=(m=t==null?void 0:t.service)==null?void 0:m.user)==null?void 0:p.username}, ${r==null?void 0:r.username} has confirmed the completion of this service, we have released the payment to your Taskitly account.`},content_available:!0}),u("Service completed and closed successfully.","success","Success",8e3)),s(E(!1)),s(D(null)),y.emit("confirmedService",(C=(b=t==null?void 0:t.service)==null?void 0:b.user)==null?void 0:C.id),s(A()),s(k("idle"))},[d]);const j=()=>{s(Y({booking_id:a}))},h=()=>{s(E(!1)),s(D(null))};return e.jsx(T,{isOpen:i,onClose:h,onRequestClose:h,type:"success",title:"Are You Satisfied With The Service?",onCancel:h,onConfirm:j,loading:l,children:e.jsx("p",{children:"Do you confirm that this service has been satisfactorily completed and we can go ahead and release the payment to the service provider?"})})};F("requests",se);const me=()=>{const s=B(),{imagePath:l}=_,{bookings:d,booking:t,completingService:i,confirmingService:a}=f(x=>x.requests.data),{bookingID:r}=f(x=>x.requests.state),{userType:u,profile:j}=f(x=>x.auth.user),h=u==="Provider",{loading:c,serviceCompleted:o,serviceConfirmed:m}=f(x=>{var O;return(O=x.requests)==null?void 0:O.data});window.OneSignal=window.OneSignal||[];const p=window.OneSignal;p.push(()=>{p.init({appId:"9749386f-0c3b-417c-b986-3447a73296cd",safari_web_id:"web.onesignal.auto.4d0b3421-6847-4c4b-a531-b4bcf634e4d8",allowLocalhostAsSecureOrigin:!0,autoResubscribe:!0})}),N.useEffect(()=>{(o||m)&&s(A()),o?s(K(!1)):m&&s(M(!1))},[s,o,m]);const b=x=>{s($(!0)),s(D(x==null?void 0:x.id))},C=x=>{s(E(!0)),s(D(x==null?void 0:x.id))};return e.jsxs("div",{className:"mt-2 p-4",children:[c?e.jsx(te,{}):e.jsxs("div",{children:[e.jsx("h4",{children:"Active Bookings"}),e.jsx("div",{className:"mt-4 mb-4",children:e.jsx(Z,{imagePath:l,bookings:d,booking:t,completingService:i,confirmingService:a,bookingID:r,isProvider:h,onComplete:b,onConfirm:C})}),e.jsx("h4",{children:"Enquiries"}),e.jsx("div",{className:"min-h-[50vh]",children:e.jsx(ie,{})})]}),e.jsx("div",{className:"sticky bottom-24 flex justify-end mr-5",children:e.jsx(z,{to:"history",children:e.jsx(Q,{variant:"solid",children:"Booking History"})})}),e.jsx(ce,{socket:y.current}),e.jsx(le,{socket:y.current})]})};export{me as default};
