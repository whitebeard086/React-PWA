import{aF as M,aG as w,aH as L,i as B,dt as H,ds as Z,aK as R,k as J,d as Q,l as W,m as X,aL as S,r as P,j as e,L as D,bf as ee,F as se,p as ae,q as te,t as ne,v as ce,a0 as re,d1 as ie,A as oe,z as C,dl as k,dm as q,o as le,O as de,ar as ue,u as V,bA as me,dq as ge,dj as he,aN as N,c as pe,dn as xe,E as be,dp as je,Y as ve,G as fe,dr as Ne}from"./index-d4dc8e82.js";import{d as Se}from"./debounce-d827693a.js";import{P as ye}from"./bundle-857a9bbb.js";const g="cable",Ce=M(),z=w(H,`${g}/data/verifyCustomer`),ke=w(Z,`${g}/data/buyData`),$=Ce.getInitialState({customer:{...L},store:null,product:null,bundle:{...L}}),Y=B({name:`${g}/data`,initialState:$,reducers:{setStore:(s,t)=>{s.store=t.payload===0?null:t.payload},setProduct:(s,t)=>{s.product=t.payload===0?null:t.payload},resetState:(s,t)=>{const o={user:()=>{s.user=$.user}}[t.payload];o&&o()}},extraReducers:s=>{R(s,z,"customer","customer"),R(s,ke,"bundle","data")}}),{setStore:G,resetState:Ye,setProduct:U}=Y.actions,Ie=Y.reducer,Pe={state:{state:!1,steps:0},kycDialog:!1,pinDialog:!1,query:{search:""}},K=B({name:`${g}/state`,initialState:Pe,reducers:{setState:(s,{payload:t})=>{s.state.state=t!==0,s.state.steps=t===0?0:t},setSearch:(s,{payload:t})=>{s.query.search=t},toggleKycDialog:(s,{payload:t})=>{s.kycDialog=t},togglePinDialog:(s,{payload:t})=>{s.pinDialog=t}}}),{setState:f,setSearch:Ge,toggleKycDialog:Ue,togglePinDialog:y}=K.actions,De=K.reducer,Ae=J({state:De,data:Ie}),p=Q,Fe=W().shape({device_number:X().required("Please enter meter number")}),_e={device_number:""},Ee=()=>{const s=S(),{store:t,customer:a,product:o}=p(n=>n[g].data),l=n=>{s(z(n))},i=P.useRef(Se(l,1e3)).current;P.useEffect(()=>()=>{i.cancel()},[]);const d=n=>{i(n)},c=n=>{s(U({...o,...n})),s(f(2))};return e.jsxs(D,{loading:!1,children:[e.jsxs("div",{className:"inline-flex items-center cursor-pointer py-2 pr-2 mb-2",onClick:()=>{s(f(0))},children:[e.jsx(ee,{})," Back"]}),e.jsx(se,{initialValues:_e,validationSchema:Fe,onSubmit:n=>c(n),children:({touched:n,errors:u,values:m})=>{var h,x,j,b,v,r,A,F,_;return e.jsx(ae,{children:e.jsxs(te,{children:[e.jsx(ne,{label:"Smart card number",invalid:u.device_number&&n.device_number,errorMessage:u.device_number,className:"xx:flex-1 xx:justify-between",children:e.jsx(ce,{name:"device_number",children:({field:E,form:O})=>e.jsx(re,{className:"xx:h-12",form:O,field:E,placeholder:"Smart card number",format:"###",onValueChange:I=>{if(O.setFieldValue(E.name,I.value),I.value.length>=11){const T={...t,device_number:I.value};console.log(T),d(T)}}})})}),((h=m==null?void 0:m.device_number)==null?void 0:h.length)>10&&e.jsx(e.Fragment,{children:(a==null?void 0:a.status)==="pending"?e.jsx(ie,{size:35,className:"mx-auto mb-3"}):e.jsx(e.Fragment,{children:((a==null?void 0:a.status)==="success"||(a==null?void 0:a.status)==="error")&&e.jsx(oe,{className:"mb-4",type:(x=a==null?void 0:a.data)!=null&&x.success&&((b=(j=a==null?void 0:a.data)==null?void 0:j.data)!=null&&b.name)?"success":"danger",showIcon:!0,children:((r=(v=a==null?void 0:a.data)==null?void 0:v.data)==null?void 0:r.name)??(a==null?void 0:a.message)})})}),e.jsx(C,{variant:"solid",type:"submit",block:!0,className:"!bg-gray-900 hover:!bg-black",disabled:!((A=a==null?void 0:a.data)!=null&&A.success)&&!((_=(F=a==null?void 0:a.data)==null?void 0:F.data)!=null&&_.name),children:"Continue"})]})})}})]})},Oe=({operators:s})=>{var o;const t=S(),a={DSTV:"/img/dstv.png",GOTV:"/img/gotv.png",STARTIMES:"/img/startimes.png"};return e.jsx(k,{className:"flex flex-col xx:grid xx:grid-cols-3 gap-3",onChange:l=>{t(G({operatorID:l[0],bill:"television"}))},children:(o=s==null?void 0:s.data)==null?void 0:o.map((l,i)=>e.jsx(k.Item,{value:l.id,children:({ref:d,active:c,value:n,onSegmentItemClick:u,disabled:m})=>e.jsx(q,{ref:d,active:c,disabled:m,className:le("bg-slate-50",c&&"bg-sky-100"),onSegmentItemClick:u,variant:"plain",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(de,{size:"lg",src:a[l.name],icon:e.jsx(ue,{})}),e.jsx("h6",{children:l==null?void 0:l.name})]})})},l.id))})},Te=()=>{var i;const s=S(),t=V(),{product:a}=p(d=>d[g].data),{hasPin:o}=p(d=>d.auth.user),l=()=>{o?s(y(!0)):t("/transaction-pin")};return e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base mb-2",children:"Your Order"}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Package:"}),e.jsx("p",{className:"text-sm font-semibold",children:a==null?void 0:a.package})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Smart Card Number:"}),e.jsx("p",{className:"text-sm font-semibold",children:a==null?void 0:a.device_number})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Subscription Cost:"}),e.jsx("p",{className:"text-sm font-semibold",children:`₦${(i=Number(a==null?void 0:a.amount))==null?void 0:i.toLocaleString()}`})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-8",children:[e.jsx(C,{block:!0,variant:"solid",color:"red-500",icon:e.jsx(me,{}),className:"",onClick:()=>s(f(1)),children:"Back"}),e.jsx(C,{block:!0,variant:"solid",icon:e.jsx(ge,{}),className:"!bg-gray-900 hover:!bg-black",onClick:l,children:"Confirm"})]})]}),e.jsx(we,{})]})},Le=()=>{var d;const{store:s}=p(c=>c[g].data),{profile:t}=p(c=>c.auth.user),a=S(),{isFetching:o,data:l}=he(s),{products:i}=l||{};return e.jsx(D,{loading:o,children:e.jsx(k,{className:"grid grid-cols-pow gap-3",onChange:c=>{var u,m,h;const n=(u=i==null?void 0:i.data)==null?void 0:u.find(x=>x.id===c[0]);if(((m=n==null?void 0:n.meta)==null?void 0:m.fee)>(t==null?void 0:t.balance)){N("Error","You do not have enough balance to complete this transaction, please top-up and try again.","danger",5e3);return}a(U({productID:c[0],bill:"television",operatorID:s==null?void 0:s.operatorID,amount:Number((h=n==null?void 0:n.meta)==null?void 0:h.fee),package:n==null?void 0:n.name})),a(f(1))},children:(d=i==null?void 0:i.data)==null?void 0:d.map((c,n)=>e.jsx(k.Item,{value:c.id,children:({ref:u,active:m,value:h,onSegmentItemClick:x,disabled:j})=>{var b,v;return e.jsx(q,{ref:u,active:m,disabled:j,className:"bg-slate-50",onSegmentItemClick:x,variant:"plain",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx("p",{children:c==null?void 0:c.name}),e.jsxs("h6",{children:["₦",(v=Number((b=c==null?void 0:c.meta)==null?void 0:b.fee))==null?void 0:v.toLocaleString()]})]})})}},c.id))})})},Re={padding:void 0,margin:void 0,textAlign:void 0,border:void 0,background:void 0,width:void 0,height:void 0},$e={outline:void 0,boxShadow:void 0},we=()=>{const s=S(),t=V(),a=pe(),[o,l]=P.useState("");let i;const{product:d}=p(r=>r[g].data),{pinDialog:c}=p(r=>r[g].state),n=()=>{s(y(!1))},u=()=>{s(y(!1)),s(f(0))},m=()=>{a.pathname!=="/profile/kyb"&&t("/profile/kyb")},h=()=>{i==null||i.clear(),l("")},x=()=>{const r={pin:o,...d};j(r)},{mutate:j,isLoading:b,error:v}=xe(r=>{console.log("error block",r),r.response.data.status==="pin error"?N(r.response.data.message,"The PIN entered does not match your transaction PIN, please try again.","danger",5e3):r.response.status===422?(N(r.response.data.status,r.response.data.message,"danger",5e3),u(),m()):(N("Error",r.response.data.message??"Oops! Something went wrong, please try again.","danger",5e3),u()),h(),n()},r=>{console.log("Success block",r),N("Success",r.message??"Transaction completed successfully.","success",5e3),h(),s(y(!1)),s(ve()),s(f(0)),s(G(0))});return e.jsxs(be,{isOpen:c,onClose:n,onRequestClose:n,shouldCloseOnOverlayClick:!1,shouldCloseOnEsc:!1,contentClassName:"mt-[30vh]",title:"Require PIN",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-700",children:"Authorize Transaction"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm mb-2",children:"Please enter your pin to authorize this transaction"}),e.jsx("div",{children:e.jsx(ye,{length:4,initialValue:"",secretDelay:200,ref:r=>i=r,onChange:r=>{l(r)},type:"numeric",inputMode:"number",inputStyle:Re,inputFocusStyle:$e,autoSelect:!0,regexCriteria:/^[ A-Za-z0-9_@./#&+-]*$/})}),e.jsx(C,{block:!0,variant:"solid",className:"!bg-gray-900 hover:!bg-black mt-6",icon:e.jsx(je,{}),loading:b,disabled:!o||(o==null?void 0:o.length)<4||b||o[0]==="0",onClick:x,children:"Authorize"})]})]})};fe(`${g}`,Ae);const Be=()=>{const{state:s}=p(c=>c[g].state),{store:t,product:a,customer:o}=p(c=>c[g].data),{data:l,isFetching:i}=Ne("television"),{operators:d}=l||{};return console.log("State: ",s),console.log("Store: ",t),e.jsx("div",{className:"p-4 mt-2",children:e.jsx(D,{loading:i,children:s.state?e.jsxs(e.Fragment,{children:[s.steps===1&&e.jsx(Ee,{}),s.steps===2&&e.jsx(Te,{})]}):e.jsxs("div",{className:"grid gap-4",children:[e.jsx(Oe,{operators:d}),t&&e.jsx(Le,{})]})})})},Ke=Be;export{Ke as Cable,Ke as default};
