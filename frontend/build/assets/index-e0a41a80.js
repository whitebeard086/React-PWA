import{r as g,aI as Q,aJ as w,aK as C,h as q,aN as k,i as Z,c as W,o as X,p as $,aO as y,j as e,B as ee,cB as se,F as ae,v as te,w as ne,x as B,y as R,I as oe,cN as ie,cO as _,cP as re,G as P,t as ce,T as v,ar as S,u as le,Y as de,bq as ue,cQ as pe,J as he,cR as me,K as ge,L as xe}from"./index-a992da42.js";import{p as b}from"./toast-9c130574.js";import{a as be,b as je,d as fe}from"./BillsService-ca4b4d0e.js";import{P as ye}from"./bundle-b0e53f2b.js";function Ne(s){const[a,o]=g.useState(!1);return g.useEffect(()=>{Array.isArray(s)&&s.length>0||s&&Object.keys(s).length>0?o(!0):o(!1)},[s]),{hasData:a}}const d="data",ve=Q(),L=w(be,`${d}/data/getOperators`),M=w(je,`${d}/data/getProducts`),Y=w(fe,`${d}/data/buyData`),z=ve.getInitialState({operators:{...C},products:{...C},bundle:{...C},store:{},pin:"",operator:null}),G=q({name:`${d}/data`,initialState:z,reducers:{setStore:(s,a)=>{s.store=a.payload===0?{}:a.payload},setPin:(s,{payload:a})=>{s.pin=a},setOperator:(s,a)=>{s.operator=a.payload===0?null:a.payload},resetState:(s,a)=>{const i={user:()=>{s.user=z.user}}[a.payload];i&&i()}},extraReducers:s=>{k(s,L,"operators","data"),k(s,M,"products","data"),k(s,Y,"bundle","data")}}),{setStore:Se,resetState:f,setOperator:Pe,setPin:Ye}=G.actions,Oe=G.reducer,Ce={state:{state:!1,steps:0},kycDialog:!1,pinDialog:!1,query:{search:""}},U=q({name:`${d}/state`,initialState:Ce,reducers:{setState:(s,{payload:a})=>{s.state.state=a!==0,s.state.steps=a===0?0:a},setSearch:(s,{payload:a})=>{s.query.search=a},toggleKycDialog:(s,{payload:a})=>{s.kycDialog=a},togglePinDialog:(s,{payload:a})=>{s.pinDialog=a}}}),{setState:D,setSearch:Ge,toggleKycDialog:Ue,togglePinDialog:E}=U.actions,ke=U.reducer,De=Z({state:ke,data:Oe}),m=W,Ee=X().shape({phone:$().matches(/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,"Phone number is not valid").required("Please enter your phone number"),bundle:$().required("Please select bundle")}),we=()=>{const s=y(),{operator:a,products:o,store:i}=m(h=>h[d].data),{profile:n}=m(h=>h.auth.user),{data:r,status:p}=o,t=p==="pending",O={phone:(i==null?void 0:i.phone)||""},l=({phone:h,bundle:x})=>{var j,N;const u=r==null?void 0:r.find(c=>c.id===x);if(((j=u==null?void 0:u.meta)==null?void 0:j.fee)>(n==null?void 0:n.balance)){b("Error","You do not have enough balance to complete this transaction, please top-up and try again.","danger",5e3);return}s(Se({oid:a==null?void 0:a.id,operator:u==null?void 0:u.name,product:x,phone:h,amount:(N=u==null?void 0:u.meta)==null?void 0:N.fee})),s(D(1))};return e.jsx("div",{className:"mt-5",children:e.jsx(ee.div,{initial:{opacity:0,visibility:"hidden"},animate:{opacity:1,visibility:"visible"},transition:{duration:.3,type:"tween"},exit:{opacity:0,visibility:"hidden"},children:t?e.jsx(se,{size:40,className:"mx-auto"}):e.jsx(ae,{initialValues:O,validationSchema:Ee,onSubmit:h=>l(h),children:({touched:h,errors:x,values:u})=>e.jsx(te,{children:e.jsxs(ne,{children:[e.jsx(B,{label:"Enter Your Phone Number",invalid:x.phone&&h.phone,errorMessage:x.phone,children:e.jsx(R,{type:"text",autoComplete:"off",name:"phone",placeholder:"Phone number",component:oe,prefix:e.jsx(ie,{className:"text-xl"})})}),e.jsx(B,{label:"Select a data bundle",invalid:x.bundle&&h.bundle,errorMessage:x.bundle,children:e.jsx(R,{name:"bundle",children:({field:j,form:N})=>e.jsx(_,{className:"grid grid-cols-card gap-3",value:[j.value],onChange:c=>N.setFieldValue(j.name,c[0]),children:e.jsx(e.Fragment,{children:r==null?void 0:r.map((c,Re)=>e.jsx(_.Item,{value:c.id,children:({ref:H,active:K,value:_e,onSegmentItemClick:V,disabled:J})=>{var A,F,I,T;return e.jsx(re,{ref:H,active:K,disabled:J,className:"bg-slate-50",onSegmentItemClick:V,variant:"plain",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx("h6",{children:(A=c==null?void 0:c.meta)==null?void 0:A.data_value}),e.jsx("p",{children:(F=c==null?void 0:c.meta)==null?void 0:F.data_expiry}),e.jsxs("p",{children:["₦",(T=Number((I=c==null?void 0:c.meta)==null?void 0:I.fee))==null?void 0:T.toLocaleString()]})]})})}},c.id))})})})}),e.jsx(P,{variant:"solid",type:"submit",block:!0,className:"!bg-gray-900 hover:!bg-black",disabled:!u.bundle||!u.phone,children:"Continue"})]})})})})})},Ae=()=>{var p;const s=y(),{operators:a,operator:o,products:i}=m(t=>t[d].data),{status:n}=i,r=t=>{s(Pe(t)),s(M({category:t.id}))};return console.log("Operators: ",a),g.useEffect(()=>{n==="error"&&(b("Error","Oops! Something went wrong, please try again.","danger",5e3),s(f("products")))},[s,n]),e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm font-semibold mb-4",children:"Choose a Network Operator"}),e.jsx("div",{className:"flex items-center gap-4 justify-around flex-wrap",children:(p=a==null?void 0:a.data)==null?void 0:p.map(t=>e.jsxs("div",{className:ce("flex flex-col gap-1 items-center cursor-pointer",n==="success"&&o.name===t.name&&"shadow-md px-4 py-2 bg-white rounded-lg border-b-2 border-primary-500"),onClick:()=>r(t),children:[t.name==="Airtel"&&e.jsx(v,{size:"lg",src:"/img/airtel.jpg",icon:e.jsx(S,{})}),t.name==="9Mobile"&&e.jsx(v,{className:"bg-white",size:"lg",src:"/img/9mobile.png",icon:e.jsx(S,{})}),t.name==="Glo"&&e.jsx(v,{className:"bg-white",size:"lg",src:"/img/Glo.png",icon:e.jsx(S,{})}),t.name==="MTN"&&e.jsx(v,{className:"bg-white",size:"lg",src:"/img/MTN.png",icon:e.jsx(S,{})}),e.jsx("p",{className:"text-sm",children:t.name})]},t.id))})]})},Fe=()=>{var p;const s=y(),a=le(),{store:o,bundle:i}=m(t=>t[d].data),{hasPin:n}=m(t=>t.auth.user);g.useEffect(()=>{i.status==="failed"&&(b("Error","Oops! Something went wrong, please try again.","danger",5e3),s(f("bundle"))),i.status==="success"&&(b("Success","Transaction completed successfully.","success",5e3),s(f("bundle")),s(de()),s(D(0)))},[s,i.status]);const r=()=>{n?s(E(!0)):a("/transaction-pin")};return e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base mb-2",children:"Your Order"}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Bundle:"}),e.jsx("p",{className:"text-sm font-semibold",children:o==null?void 0:o.operator})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Phone Number:"}),e.jsx("p",{className:"text-sm font-semibold",children:o==null?void 0:o.phone})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Bundle Cost:"}),e.jsx("p",{className:"text-sm font-semibold",children:`₦${(p=o==null?void 0:o.amount)==null?void 0:p.toLocaleString()}`})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-8",children:[e.jsx(P,{block:!0,variant:"solid",color:"red-500",icon:e.jsx(ue,{}),className:"",disabled:i.status==="pending",onClick:()=>s(D(0)),children:"Back"}),e.jsx(P,{block:!0,variant:"solid",icon:e.jsx(pe,{}),className:"!bg-gray-900 hover:!bg-black",loading:i.status==="pending",onClick:r,children:"Confirm"})]})]}),e.jsx($e,{})]})},Ie={padding:void 0,margin:void 0,textAlign:void 0,border:void 0,background:void 0,width:void 0,height:void 0},Te={outline:void 0,boxShadow:void 0},$e=()=>{const s=y(),[a,o]=g.useState("");let i;const{store:n,bundle:r}=m(l=>l[d].data),{pinDialog:p}=m(l=>l[d].state),t=()=>{s(E(!1))};g.useEffect(()=>{const l=()=>{i==null||i.clear(),o("")};r.status==="failed"&&(b("Error","Oops! Something went wrong, please try again.","danger",5e3),l(),s(f("bundle")),t()),r.status==="pin error"&&(b("Error","The PIN entered does not match your transaction PIN, please try again.","danger",5e3),l(),s(f("bundle"))),r.status==="success"&&(l(),s(E(!1)))},[r.status]);const O=()=>{s(Y({pin:a,phone:n==null?void 0:n.phone,amount:n==null?void 0:n.amount,product:n==null?void 0:n.product,operator:n==null?void 0:n.oid}))};return e.jsxs(he,{isOpen:p,onClose:t,onRequestClose:t,shouldCloseOnOverlayClick:!1,shouldCloseOnEsc:!1,contentClassName:"mt-[30vh]",title:"Require PIN",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-700",children:"Authorize Transaction"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm mb-2",children:"Please enter your transaction pin to authorize this transaction"}),e.jsx("div",{children:e.jsx(ye,{length:6,initialValue:"",secretDelay:200,ref:l=>i=l,onChange:l=>{o(l)},type:"numeric",inputMode:"number",inputStyle:Ie,inputFocusStyle:Te,autoSelect:!0,regexCriteria:/^[ A-Za-z0-9_@./#&+-]*$/})}),e.jsx(P,{block:!0,variant:"solid",className:"!bg-gray-900 hover:!bg-black mt-6",icon:e.jsx(me,{}),loading:r.status==="pending",disabled:!a||(a==null?void 0:a.length)<6,onClick:O,children:"Authorize"})]})]})};ge(`${d}`,De);const Be=()=>{const s=y();g.useState(1);const{state:a}=m(t=>t[d].state),{operators:o,products:i,store:n}=m(t=>t[d].data),{hasData:r}=Ne(i.data),p=["pending","idle"].includes(o.status);return g.useEffect(()=>{s(L())},[]),console.log("Products: ",i),console.log("Store: ",n),console.log("State: ",a),console.log("HasData: ",r),e.jsx("div",{className:"p-4 mt-2",children:e.jsx(xe,{loading:p,children:a.state?e.jsx(e.Fragment,{children:a.steps===1&&e.jsx(Fe,{})}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{}),r&&e.jsx(we,{})]})})})},He=Be;export{He as default};
