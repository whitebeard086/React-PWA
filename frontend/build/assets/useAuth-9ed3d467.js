import{a as y,u as O,c as d,r as E,as as I,at as l,au as o,av as _,ar as f,aw as x,ax as P,T as U,ay as N}from"./index-2aa62b4f.js";function T(){window.OneSignal=window.OneSignal||[];const t=window.OneSignal,s=y(),g=O(),{token:p,signedIn:h}=d(n=>n.auth.session),{enabledNotifications:u}=d(n=>n.auth.user);E.useEffect(()=>{t.push(()=>{t.init({appId:"9749386f-0c3b-417c-b986-3447a73296cd",safari_web_id:"web.onesignal.auto.4d0b3421-6847-4c4b-a531-b4bcf634e4d8",allowLocalhostAsSecureOrigin:!0,autoResubscribe:!0})})},[]);const S=async n=>{var i,r,e;try{const a=await I(n);if(a.data){const{token:w}=a.data;if(s(l(w)),a.data.user){s(o({profile:a.data.user,userType:a.data.user.profile_type.name,hasVisited:!1,hasService:!!a.data.user.service,verifiedPhone:a.data.user.phone_verified_at!==null,userSet:!0}));let v=(i=a.data.user)==null?void 0:i.id;t.push(function(){t.isPushNotificationsEnabled(function(m){m?(console.log("Push notifications are enabled!"),t.setExternalUserId(v),u||s(f(!0))):(console.log("Push notifications are not enabled yet."),u&&s(f(!1)))})}),console.log("fired")}return{status:"success",message:""}}}catch(a){return{status:"failed",message:((e=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:e.message)||a.toString()}}},b=async n=>{var i,r;try{const e=await x(n);if(e.data){const{token:a}=e.data;return s(l(a)),e.data.user&&s(o({profile:e.data.user,userType:e.data.user.profile_type.name,hasVisited:!0,hasService:!!e.data.user.service,verifiedPhone:e.data.user.phone_verified_at!==null,userSet:!0})),{status:"success",message:""}}}catch(e){return{status:"failed",message:((r=(i=e==null?void 0:e.response)==null?void 0:i.data)==null?void 0:r.message)||e.toString()}}},c=()=>{s(P()),s(o(_)),t.push(function(){t.removeExternalUserId(),console.log("External user id removed")}),g(U.unAuthenticatedEntryPath),window.location.reload()};return{authenticated:p&&h,signIn:S,signUp:b,signOut:async()=>{await N(),c()},handleSignOut:c}}export{T as u};
