import{f as T,ap as C,c as S,g as ae,j as a,q as g,S as d,aF as w,a as j,n as x,aC as te,t as se,r as v,P as z,F as re,p as P,Q as ne,U as ce,bM as oe,bN as le,o as ie,w as G,bO as de,V as U,W as Y,D as L,bs as ue,y as he}from"./index-508e130b.js";import{h as pe}from"./index.esm-985d0e24.js";import{c as xe,a as I}from"./index.esm-5685692b.js";import{F as me,a as fe,b as M}from"./formik.esm-5d2ef744.js";import{P as ge}from"./PasswordInput-29c811c0.js";const Q=T({name:"withdraw/state",initialState:{formData:{},selectedAccount:null,deleteDialog:!1,accountDialog:!1,withdrawDialog:!1,isValidAccountNumber:!1},reducers:{setFormData:(t,e)=>{t.formData=e.payload},setSelectedAccount:(t,e)=>{t.selectedAccount=e.payload},toggleDeleteDialog:(t,e)=>{t.deleteDialog=e.payload},toggleAccountDialog:(t,e)=>{t.accountDialog=e.payload},toggleWithdrawDialog:(t,e)=>{t.withdrawDialog=e.payload},setIsValidAccountNumber:(t,e)=>{t.isValidAccountNumber=e.payload}}}),{setFormData:we,toggleDeleteDialog:k,setSelectedAccount:H,toggleAccountDialog:B,toggleWithdrawDialog:be,setIsValidAccountNumber:$}=Q.actions,je=Q.reducer;async function ye(t){return C.fetchData({url:"/withdraw",method:"get",data:t})}async function ve(t){return C.fetchData({url:"/withdraw/account/resolve",method:"post",data:t})}async function Ne(t){return C.fetchData({url:"/withdraw/new-account",method:"post",data:t})}async function Ce(t){return C.fetchData({url:"/withdraw/transfer-recipient",method:"post",data:t})}async function Se(t){return C.fetchData({url:"/withdraw/account/delete",method:"post",data:t})}const b=S("payments/data/getWithdrawalData",async(t,{rejectWithValue:e})=>{try{return(await ye(t)).data}catch(s){return e(s.response.data)}}),N=S("payments/data/resolveAccountNumber",async(t,{rejectWithValue:e})=>{try{return(await ve(t)).data}catch(s){return e(s.response.data)}}),R=S("payments/data/createTransferRecipient",async(t,{rejectWithValue:e})=>{try{return(await Ce(t)).data}catch(s){return e(s.response.data)}}),F=S("payments/data/addAccount",async(t,{rejectWithValue:e})=>{try{return(await Ne(t)).data}catch(s){return e(s.response.data)}}),O=S("payments/data/removeAccount",async(t,{rejectWithValue:e})=>{try{return(await Se(t)).data}catch(s){return e(s.response.data)}}),J=T({name:"withdraw/data",initialState:{loading:!1,deleting:!1,addingAccount:!1,resolvingAccount:!1,creatingRecipient:!1,accounts:[],account:{},recipient:{},resolvedAccount:{},banks:[],status:"idle",deleteStatus:"idle",accountStatus:"idle",resolveStatus:"idle",recipientStatus:"idle",deleteError:"",errorMessage:"",accountError:"",resolveError:"",recipientError:""},reducers:{setStatus:(t,e)=>{t.status=e.payload},setAccount:(t,e)=>{t.account=e.payload},setDeleteStatus:(t,e)=>{t.deleteStatus=e.payload},setAccountStatus:(t,e)=>{t.accountStatus=e.payload},setResolveStatus:(t,e)=>{t.resolveStatus=e.payload},setRecipientError:(t,e)=>{t.recipientError=e.payload},setRecipientStatus:(t,e)=>{t.recipientStatus=e.payload}},extraReducers:t=>{t.addCase(b.pending,e=>{e.loading=!0}).addCase(b.fulfilled,(e,s)=>{var c;e.loading=!1;const{banks:r,status:n}=s.payload;e.status=n,e.banks=(c=r==null?void 0:r.response)==null?void 0:c.data}).addCase(b.rejected,(e,s)=>{e.loading=!1;const{status:r,message:n}=s.payload;e.status=r,e.errorMessage=n}).addCase(N.pending,e=>{e.resolvingAccount=!0}).addCase(N.fulfilled,(e,s)=>{e.resolvingAccount=!1;const{response:r,status:n}=s.payload;e.resolvedAccount=r.data,e.resolveStatus=n,e.resolveError!==""&&(e.resolveError="")}).addCase(N.rejected,(e,s)=>{e.resolvingAccount=!1;const{message:r,status:n}=s.payload;e.resolveError=r,e.resolveStatus=n,e.resolvedAccount!=={}&&(e.resolvedAccount={})}).addCase(R.pending,e=>{e.creatingRecipient=!0}).addCase(R.fulfilled,(e,s)=>{e.creatingRecipient=!1;const{status:r,response:n}=s.payload;e.recipient=n.data,e.recipientStatus=r,e.recipientError!==""&&(e.recipientError="")}).addCase(R.rejected,(e,s)=>{e.creatingRecipient=!1;const{status:r,message:n}=s.payload;e.recipientStatus=r,e.recipientError=n,e.recipient!=={}&&(e.recipient={})}).addCase(F.pending,e=>{e.addingAccount=!0}).addCase(F.fulfilled,(e,s)=>{e.addingAccount=!1;const{status:r,account:n}=s.payload;e.account=n,e.accountStatus=r,e.accountError!==""&&(e.accountError=""),e.resolvedAccount!=={}&&(e.resolvedAccount={},e.resolveStatus="idle")}).addCase(F.rejected,(e,s)=>{e.addingAccount=!1;const{status:r,message:n}=s.payload;e.accountStatus=r,e.accountError=n,e.account!=={}&&(e.account={})}).addCase(O.pending,e=>{e.deleting=!0}).addCase(O.fulfilled,(e,s)=>{e.deleting=!1;const{status:r}=s.payload;e.deleteStatus=r,e.deleteError!==""&&(e.deleteError="")}).addCase(O.rejected,(e,s)=>{e.deleting=!1;const{status:r,message:n}=s.payload;e.deleteStatus=r,e.deleteError=n})}}),{setStatus:Te,setAccount:ze,setDeleteStatus:Ae,setAccountStatus:De,setResolveStatus:Ee,setRecipientError:Ge,setRecipientStatus:q}=J.actions,ke=J.reducer,Re=ae({state:je,data:ke}),Fe=()=>a.jsxs("div",{className:"flex flex-col",children:[a.jsx(g,{bodyClass:"w-full",children:a.jsxs("div",{className:"flex w-full items-center justify-between",children:[a.jsxs("div",{className:"flex flex-col gap-1 w-full",children:[a.jsx(d,{height:"20px",width:"30%"}),a.jsx(d,{height:"14px",width:"25%"}),a.jsx(d,{height:"14px",width:"35%"})]}),a.jsx("div",{className:"bg-gray-100 hover:bg-gray-200 transition duration-300 w-10 h-10 grid place-content-center rounded-full cursor-pointer",children:a.jsx(w,{className:"text-2xl text-red-500 hover:text-red-600 transition duration-300"})})]})}),a.jsx(g,{bodyClass:"w-full",children:a.jsxs("div",{className:"flex w-full items-center justify-between",children:[a.jsxs("div",{className:"flex flex-col gap-1 w-full",children:[a.jsx(d,{height:"20px",width:"30%"}),a.jsx(d,{height:"14px",width:"25%"}),a.jsx(d,{height:"14px",width:"35%"})]}),a.jsx("div",{className:"bg-gray-100 hover:bg-gray-200 transition duration-300 w-10 h-10 grid place-content-center rounded-full cursor-pointer",children:a.jsx(w,{className:"text-2xl text-red-500 hover:text-red-600 transition duration-300"})})]})}),a.jsx(g,{bodyClass:"w-full",children:a.jsxs("div",{className:"flex w-full items-center justify-between",children:[a.jsxs("div",{className:"flex flex-col gap-1 w-full",children:[a.jsx(d,{height:"20px",width:"30%"}),a.jsx(d,{height:"14px",width:"25%"}),a.jsx(d,{height:"14px",width:"35%"})]}),a.jsx("div",{className:"bg-gray-100 hover:bg-gray-200 transition duration-300 w-10 h-10 grid place-content-center rounded-full cursor-pointer",children:a.jsx(w,{className:"text-2xl text-red-500 hover:text-red-600 transition duration-300"})})]})}),a.jsx(g,{bodyClass:"w-full",children:a.jsxs("div",{className:"flex w-full items-center justify-between",children:[a.jsxs("div",{className:"flex flex-col gap-1 w-full",children:[a.jsx(d,{height:"20px",width:"30%"}),a.jsx(d,{height:"14px",width:"25%"}),a.jsx(d,{height:"14px",width:"35%"})]}),a.jsx("div",{className:"bg-gray-100 hover:bg-gray-200 transition duration-300 w-10 h-10 grid place-content-center rounded-full cursor-pointer",children:a.jsx(w,{className:"text-2xl text-red-500 hover:text-red-600 transition duration-300"})})]})}),a.jsx(g,{bodyClass:"w-full",children:a.jsxs("div",{className:"flex w-full items-center justify-between",children:[a.jsxs("div",{className:"flex flex-col gap-1 w-full",children:[a.jsx(d,{height:"20px",width:"30%"}),a.jsx(d,{height:"14px",width:"25%"}),a.jsx(d,{height:"14px",width:"35%"})]}),a.jsx("div",{className:"bg-gray-100 hover:bg-gray-200 transition duration-300 w-10 h-10 grid place-content-center rounded-full cursor-pointer",children:a.jsx(w,{className:"text-2xl text-red-500 hover:text-red-600 transition duration-300"})})]})}),a.jsx(g,{bodyClass:"w-full",children:a.jsxs("div",{className:"flex w-full items-center justify-between",children:[a.jsxs("div",{className:"flex flex-col gap-1 w-full",children:[a.jsx(d,{height:"20px",width:"30%"}),a.jsx(d,{height:"14px",width:"25%"}),a.jsx(d,{height:"14px",width:"35%"})]}),a.jsx("div",{className:"bg-gray-100 hover:bg-gray-200 transition duration-300 w-10 h-10 grid place-content-center rounded-full cursor-pointer",children:a.jsx(w,{className:"text-2xl text-red-500 hover:text-red-600 transition duration-300"})})]})})]}),Oe=()=>{const t=j(),{profile:e}=x(c=>c.auth.user),s=e==null?void 0:e.withdrawal_accounts,r=c=>{t(H(c.id)),t(k(!0)),console.log(c)},n=c=>{};return a.jsx("div",{children:(s==null?void 0:s.length)<1?a.jsx("div",{className:"min-h-[30vh] grid place-content-center",children:a.jsxs("p",{className:"text-center text-gray-400 font-bold text-2xl",children:["You have not added ",a.jsx("br",{})," any withdrawal accounts..."]})}):a.jsx(te,{children:a.jsx("div",{className:"flex flex-col",children:s==null?void 0:s.map(c=>a.jsx(se.div,{layoutId:c.id,initial:{opacity:0,visibility:"hidden"},animate:{opacity:1,visibility:"visible"},transition:{duration:.2,type:"tween"},exit:{opacity:0,visibility:"hidden"},children:a.jsx(g,{onClick:()=>n(),clickable:!0,bodyClass:"w-full",children:a.jsxs("div",{className:"flex w-full items-center justify-between",children:[a.jsxs("div",{className:"flex flex-col w-full",children:[a.jsx("h4",{className:"text-base",children:c.bank_name}),a.jsx("p",{className:"text-base",children:c.account_number}),a.jsx("p",{className:"text-base",children:c.account_name})]}),a.jsx("div",{onClick:()=>r(c),className:"bg-gray-100 hover:bg-gray-200 transition duration-300 w-10 h-10 grid place-content-center rounded-full cursor-pointer hover:shadow-md",children:a.jsx(w,{className:"text-2xl text-red-500 hover:text-red-600 transition duration-300"})})]})})},c.id))})})})},Ve=()=>{const t=j(),{banks:e,resolvingAccount:s,resolvedAccount:r,resolveStatus:n,resolveError:c,accountStatus:h,recipientStatus:m,recipient:l,creatingRecipient:V,addingAccount:W}=x(o=>o.withdraw.data),{isValidAccountNumber:f,formData:_}=x(o=>o.withdraw.state),K=xe().shape({bank:I().required("Please select a bank"),accNumber:I().required("Please enter your account number"),password:I().required("Please enter your password")}),X={bank:"",accNumber:"",password:""},A=e==null?void 0:e.map(o=>({label:o.name,value:o.code})),D=(o,i,u,p)=>{U.push(a.jsx(Y,{title:u||"Error",type:i||"warning",duration:p||3e3,children:o}),{placement:"top-center"})};v.useEffect(()=>{c!==""&&t(Ee("idle"))},[c,n]),v.useEffect(()=>{(h==="error"||m==="error")&&D("Oops! Something went wrong, please try again.","danger","Error",5e3),h==="password error"&&D("The password entered does not match your account password, please try again.","danger","Error",5e3),h==="duplicate error"&&D("Account already added or in use by another user","danger","Error",5e3),h==="success"&&(t(B(!1)),t(z()),t(b()),D("Withdrawal account added successfully.","success","Success",5e3)),(h==="error"||h==="password error"||h==="duplicate error"||h==="success")&&(t(De("idle")),t(q("idle"))),m==="error"&&t(q("idle"))},[h,t,m]),v.useEffect(()=>{var o,i,u;m==="success"&&t(F({bankName:(o=l==null?void 0:l.details)==null?void 0:o.bank_name,accountNumber:(i=l==null?void 0:l.details)==null?void 0:i.account_number,accountName:(u=l==null?void 0:l.details)==null?void 0:u.account_name,recipientCode:l==null?void 0:l.recipient_code,password:_==null?void 0:_.password}))},[m]);const Z=o=>{const{bank:i,accNumber:u,password:p}=o;t(we({bankCode:i,accountNumber:u,password:p})),t(R({accountName:r==null?void 0:r.account_name,accountNumber:u,bankCode:i}))},ee=(o,i,u,p)=>{u.setFieldValue(p.name,o.floatValue),o.value.length>=10?f||t($(!0)):f&&t($(!1)),o.value.length===10&&i.bank&&t(N({accountNumber:o.floatValue,bankCode:i.bank}))};return a.jsx("div",{className:"mt-10",children:a.jsx(me,{initialValues:X,validationSchema:K,onSubmit:(o,{setSubmitting:i})=>{Z(o)},children:({touched:o,errors:i,values:u})=>a.jsx(fe,{children:a.jsxs(re,{children:[a.jsx(P,{label:"",invalid:i.bank&&o.bank,className:"w-full",errorMessage:i.bank,children:a.jsx(M,{name:"bank",prefix:"",className:"w-full",autoComplete:"off",children:({field:p,form:y})=>a.jsx(ne,{placeholder:"Select a Bank",field:p,form:y,className:"w-full",options:A,value:A==null?void 0:A.value,onChange:E=>{y.setFieldValue(p.name,E.value),u.accNumber>=10&&t(N({accountNumber:u.accNumber,bankCode:E.value}))}})})}),a.jsx(P,{label:"",invalid:i.accNumber&&o.accNumber,errorMessage:i.accNumber,children:a.jsx(M,{name:"accNumber",children:({field:p,form:y})=>a.jsx(ce,{thousandSeparator:!1,form:y,field:p,maxLength:10,placeholder:"Enter Account Number",decimalScale:0,value:p.value,onValueChange:E=>{ee(E,u,y,p)}})})}),u.bank&&f&&s?a.jsx("div",{className:"p-2 mb-4 grid place-content-center",children:a.jsx(oe,{indicator:le,color:"primary-500",size:24})}):u.bank&&f&&(r!=null&&r.account_name||c)?a.jsx("div",{className:ie("p-2 border-2 mb-4 rounded-lg",c&&"border-red-500",n==="success"&&"border-primary-500"),children:a.jsxs("p",{className:"text-sm font-semibold text-gray-500",children:[c&&"Invalid account details",n==="success"&&(r==null?void 0:r.account_name)]})}):null,a.jsx(P,{label:"",invalid:i.password&&o.password,errorMessage:i.password,children:a.jsx(M,{autoComplete:"off",name:"password",placeholder:"Enter Your Password",component:ge})}),a.jsx(G,{block:!0,loading:V||W,disabled:!f||!(r!=null&&r.account_name)||!u.password,variant:"solid",type:"submit",icon:a.jsx(de,{}),className:"!bg-gray-900 hover:!bg-black",children:"Save"})]})})})})},We=()=>{const t=j(),{accountDialog:e}=x(r=>r.withdraw.state),s=()=>{t(B(!1))};return a.jsxs(L,{isOpen:e,onClose:s,shouldCloseOnOverlayClick:!1,shouldCloseOnEsc:!1,scrollable:!0,className:"overflow-y-auto",bodyOpenClassName:"overflow-hidden",contentClassName:"mt-[20vh]",title:"Add New Account",children:[a.jsx("h4",{className:"text-lg font-bold text-gray-700",children:"Add a New Bank Account"}),a.jsx("div",{className:"mt-4 min-h-[40vh]",children:a.jsx(Ve,{})})]})},_e=()=>{const t=j(),{deleteStatus:e,deleting:s}=x(l=>l.withdraw.data),{deleteDialog:r,selectedAccount:n}=x(l=>l.withdraw.state),c=()=>{t(H(null)),t(k(!1))},h=(l,V,W,f)=>{U.push(a.jsx(Y,{title:W||"Error",type:V||"warning",duration:f||3e3,children:l}),{placement:"top-center"})};v.useEffect(()=>{e==="error"&&(t(k(!1)),h("Oops! Something went wrong, please try again.","danger","Error",5e3)),e==="success"&&(t(k(!1)),t(z()),t(b()),h("Withdrawal account removed successfully","success","Success",5e3)),(e==="error"||e==="success")&&t(Ae("idle"))},[e,t]);const m=()=>{t(O({id:n}))};return a.jsx(ue,{isOpen:r,onClose:c,onRequestClose:c,type:"danger",title:"Remove Withdrawal Account?",buttonColor:"red-500",loading:s,onCancel:c,onConfirm:m,children:a.jsx("p",{children:"Do you confirm that you want to remove this withdrawal account?"})})},Pe=()=>{const t=j(),{withdrawDialog:e}=x(r=>r.withdraw.state),s=()=>{t(be(!1))};return a.jsx(L,{isOpen:e,onClose:s,shouldCloseOnOverlayClick:!1,shouldCloseOnEsc:!1,scrollable:!0,className:"overflow-y-auto",bodyOpenClassName:"overflow-hidden",contentClassName:"mt-[20vh]",title:"Add New Account"})};he("withdraw",Re);const Ue=()=>{const t=j(),{loading:e}=x(r=>r.withdraw.data);v.useEffect(()=>{t(b())},[]);const s=()=>{t(B(!0))};return a.jsxs("div",{className:"mt-2 p-4",children:[a.jsxs("div",{className:"flex items-center gap-4 justify-between flex-wrap",children:[a.jsx("h4",{className:"text-lg font-bold text-gray-700",children:"Withdrawal Banks"}),a.jsx(G,{size:"sm",variant:"solid",disabled:e,icon:a.jsx(pe,{}),onClick:s,className:"!bg-gray-900 hover:!bg-black",children:"Add Account"})]}),a.jsx("div",{className:"mt-4",children:e?a.jsx(Fe,{}):a.jsx(Oe,{})}),a.jsx(We,{}),a.jsx(_e,{}),a.jsx(Pe,{})]})};export{Ue as default};
