import{r as m,aF as Z,aG as w,aH as C,h as L,d0 as J,d1 as W,d3 as X,aK as D,i as ee,c as se,k as ae,l as T,aL as y,j as e,w as te,cQ as ne,F as oe,o as ie,p as re,q as _,t as B,I as ce,d4 as le,d5 as R,d6 as de,y as P,aN as b,n as ue,M as v,ao as S,u as pe,U as he,bo as ge,d7 as me,D as xe,d8 as be,E as je,L as fe}from"./index-cd793fee.js";import{P as ye}from"./bundle-248220b4.js";function Ne(s){const[a,o]=m.useState(!1);return m.useEffect(()=>{Array.isArray(s)&&s.length>0||s&&Object.keys(s).length>0?o(!0):o(!1)},[s]),{hasData:a}}const d="data",ve=Z(),q=w(J,`${d}/data/getOperators`),M=w(W,`${d}/data/getProducts`),U=w(X,`${d}/data/buyData`),z=ve.getInitialState({operators:{...C},products:{...C},bundle:{...C},store:{},pin:"",operator:null}),G=L({name:`${d}/data`,initialState:z,reducers:{setStore:(s,a)=>{s.store=a.payload===0?{}:a.payload},setPin:(s,{payload:a})=>{s.pin=a},setOperator:(s,a)=>{s.operator=a.payload===0?null:a.payload},resetState:(s,a)=>{const i={user:()=>{s.user=z.user}}[a.payload];i&&i()}},extraReducers:s=>{D(s,q,"operators","data"),D(s,M,"products","data"),D(s,U,"bundle","data")}}),{setStore:Se,resetState:f,setOperator:Pe,setPin:qe}=G.actions,ke=G.reducer,Ce={state:{state:!1,steps:0},kycDialog:!1,pinDialog:!1,query:{search:""}},H=L({name:`${d}/state`,initialState:Ce,reducers:{setState:(s,{payload:a})=>{s.state.state=a!==0,s.state.steps=a===0?0:a},setSearch:(s,{payload:a})=>{s.query.search=a},toggleKycDialog:(s,{payload:a})=>{s.kycDialog=a},togglePinDialog:(s,{payload:a})=>{s.pinDialog=a}}}),{setState:E,setSearch:Me,toggleKycDialog:Ue,togglePinDialog:O}=H.actions,De=H.reducer,Ee=ee({state:De,data:ke}),g=se,Oe=ae().shape({phone:T().matches(/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,"Phone number is not valid").required("Please enter your phone number"),bundle:T().required("Please select bundle")}),we=()=>{const s=y(),{operator:a,products:o,store:i}=g(h=>h[d].data),{profile:n}=g(h=>h.auth.user),{data:r,status:p}=o,t=p==="pending",k={phone:(i==null?void 0:i.phone)||""},l=({phone:h,bundle:x})=>{var j,N;const u=r==null?void 0:r.find(c=>c.id===x);if(((j=u==null?void 0:u.meta)==null?void 0:j.fee)>(n==null?void 0:n.balance)){b("Error","You do not have enough balance to complete this transaction, please top-up and try again.","danger",5e3);return}s(Se({oid:a==null?void 0:a.id,operator:u==null?void 0:u.name,product:x,phone:h,amount:(N=u==null?void 0:u.meta)==null?void 0:N.fee})),s(E(1))};return e.jsx("div",{className:"mt-5",children:e.jsx(te.div,{initial:{opacity:0,visibility:"hidden"},animate:{opacity:1,visibility:"visible"},transition:{duration:.3,type:"tween"},exit:{opacity:0,visibility:"hidden"},children:t?e.jsx(ne,{size:40,className:"mx-auto"}):e.jsx(oe,{initialValues:k,validationSchema:Oe,onSubmit:h=>l(h),children:({touched:h,errors:x,values:u})=>e.jsx(ie,{children:e.jsxs(re,{children:[e.jsx(_,{label:"Enter Your Phone Number",invalid:x.phone&&h.phone,errorMessage:x.phone,children:e.jsx(B,{type:"text",autoComplete:"off",name:"phone",placeholder:"Phone number",component:ce,prefix:e.jsx(le,{className:"text-xl"})})}),e.jsx(_,{label:"Select a data bundle",invalid:x.bundle&&h.bundle,errorMessage:x.bundle,children:e.jsx(B,{name:"bundle",children:({field:j,form:N})=>e.jsx(R,{className:"grid grid-cols-card gap-3",value:[j.value],onChange:c=>N.setFieldValue(j.name,c[0]),children:e.jsx(e.Fragment,{children:r==null?void 0:r.map((c,Be)=>e.jsx(R.Item,{value:c.id,children:({ref:Y,active:K,value:Re,onSegmentItemClick:V,disabled:Q})=>{var A,F,I,$;return e.jsx(de,{ref:Y,active:K,disabled:Q,className:"bg-slate-50",onSegmentItemClick:V,variant:"plain",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx("h6",{children:(A=c==null?void 0:c.meta)==null?void 0:A.data_value}),e.jsx("p",{children:(F=c==null?void 0:c.meta)==null?void 0:F.data_expiry}),e.jsxs("p",{children:["₦",($=Number((I=c==null?void 0:c.meta)==null?void 0:I.fee))==null?void 0:$.toLocaleString()]})]})})}},c.id))})})})}),e.jsx(P,{variant:"solid",type:"submit",block:!0,className:"!bg-gray-900 hover:!bg-black",disabled:!u.bundle||!u.phone,children:"Continue"})]})})})})})},Ae=()=>{var p;const s=y(),{operators:a,operator:o,products:i}=g(t=>t[d].data),{status:n}=i,r=t=>{s(Pe(t)),s(M({category:t.id}))};return console.log("Operators: ",a),m.useEffect(()=>{n==="error"&&(b("Error","Oops! Something went wrong, please try again.","danger",5e3),s(f("products")))},[s,n]),e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm font-semibold mb-4",children:"Choose a Network Operator"}),e.jsx("div",{className:"flex items-center gap-4 justify-around flex-wrap",children:(p=a==null?void 0:a.data)==null?void 0:p.map(t=>e.jsxs("div",{className:ue("flex flex-col gap-1 items-center cursor-pointer",n==="success"&&o.name===t.name&&"shadow-md px-4 py-2 bg-white rounded-lg border-b-2 border-primary-500"),onClick:()=>r(t),children:[t.name==="Airtel"&&e.jsx(v,{size:"lg",src:"/img/airtel.jpg",icon:e.jsx(S,{})}),t.name==="9Mobile"&&e.jsx(v,{className:"bg-white",size:"lg",src:"/img/9mobile.png",icon:e.jsx(S,{})}),t.name==="Glo"&&e.jsx(v,{className:"bg-white",size:"lg",src:"/img/Glo.png",icon:e.jsx(S,{})}),t.name==="MTN"&&e.jsx(v,{className:"bg-white",size:"lg",src:"/img/MTN.png",icon:e.jsx(S,{})}),e.jsx("p",{className:"text-sm",children:t.name})]},t.id))})]})},Fe=()=>{var p;const s=y(),a=pe(),{store:o,bundle:i}=g(t=>t[d].data),{hasPin:n}=g(t=>t.auth.user);m.useEffect(()=>{i.status==="failed"&&(b("Error","Oops! Something went wrong, please try again.","danger",5e3),s(f("bundle"))),i.status==="success"&&(b("Success","Transaction completed successfully.","success",5e3),s(f("bundle")),s(he()),s(E(0)))},[s,i.status]);const r=()=>{n?s(O(!0)):a("/transaction-pin")};return e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base mb-2",children:"Your Order"}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Bundle:"}),e.jsx("p",{className:"text-sm font-semibold",children:o==null?void 0:o.operator})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Phone Number:"}),e.jsx("p",{className:"text-sm font-semibold",children:o==null?void 0:o.phone})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Bundle Cost:"}),e.jsx("p",{className:"text-sm font-semibold",children:`₦${(p=o==null?void 0:o.amount)==null?void 0:p.toLocaleString()}`})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-8",children:[e.jsx(P,{block:!0,variant:"solid",color:"red-500",icon:e.jsx(ge,{}),className:"",disabled:i.status==="pending",onClick:()=>s(E(0)),children:"Back"}),e.jsx(P,{block:!0,variant:"solid",icon:e.jsx(me,{}),className:"!bg-gray-900 hover:!bg-black",loading:i.status==="pending",onClick:r,children:"Confirm"})]})]}),e.jsx(Te,{})]})},Ie={padding:void 0,margin:void 0,textAlign:void 0,border:void 0,background:void 0,width:void 0,height:void 0},$e={outline:void 0,boxShadow:void 0},Te=()=>{const s=y(),[a,o]=m.useState("");let i;const{store:n,bundle:r}=g(l=>l[d].data),{pinDialog:p}=g(l=>l[d].state),t=()=>{s(O(!1))};m.useEffect(()=>{const l=()=>{i==null||i.clear(),o("")};r.status==="failed"&&(b("Error","Oops! Something went wrong, please try again.","danger",5e3),l(),s(f("bundle")),t()),r.status==="pin error"&&(b("Error","The PIN entered does not match your transaction PIN, please try again.","danger",5e3),l(),s(f("bundle"))),r.status==="success"&&(l(),s(O(!1)))},[r.status]);const k=()=>{s(U({pin:a,phone:n==null?void 0:n.phone,amount:n==null?void 0:n.amount,product:n==null?void 0:n.product,operator:n==null?void 0:n.oid}))};return e.jsxs(xe,{isOpen:p,onClose:t,onRequestClose:t,shouldCloseOnOverlayClick:!1,shouldCloseOnEsc:!1,contentClassName:"mt-[30vh]",title:"Require PIN",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-700",children:"Authorize Transaction"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm mb-2",children:"Please enter your transaction pin to authorize this transaction"}),e.jsx("div",{children:e.jsx(ye,{length:6,initialValue:"",secretDelay:200,ref:l=>i=l,onChange:l=>{o(l)},type:"numeric",inputMode:"number",inputStyle:Ie,inputFocusStyle:$e,autoSelect:!0,regexCriteria:/^[ A-Za-z0-9_@./#&+-]*$/})}),e.jsx(P,{block:!0,variant:"solid",className:"!bg-gray-900 hover:!bg-black mt-6",icon:e.jsx(be,{}),loading:r.status==="pending",disabled:!a||(a==null?void 0:a.length)<6,onClick:k,children:"Authorize"})]})]})};je(`${d}`,Ee);const _e=()=>{const s=y();m.useState(1);const{state:a}=g(t=>t[d].state),{operators:o,products:i,store:n}=g(t=>t[d].data),{hasData:r}=Ne(i.data),p=["pending","idle"].includes(o.status);return m.useEffect(()=>{s(q())},[]),console.log("Products: ",i),console.log("Store: ",n),console.log("State: ",a),console.log("HasData: ",r),e.jsx("div",{className:"p-4 mt-2",children:e.jsx(fe,{loading:p,children:a.state?e.jsx(e.Fragment,{children:a.steps===1&&e.jsx(Fe,{})}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{}),r&&e.jsx(we,{})]})})})},Ge=_e;export{Ge as default};
