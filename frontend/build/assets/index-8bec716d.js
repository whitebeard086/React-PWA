import{aF as H,aG as O,aH as $,h as R,d9 as M,d3 as Y,aK as E,i as z,c as Q,k as T,l as X,aL as j,r as B,j as e,L as C,db as J,F as U,o as W,p as Z,q as ee,t as ae,X as se,cQ as te,A as ne,y as S,d5 as f,d6 as w,u as ce,bo as re,d7 as ie,da as le,aN as oe,E as de,dc as ue}from"./index-cd793fee.js";import{d as me}from"./debounce-0d96812f.js";import"./bundle-248220b4.js";const o="cable",xe=H(),V=O(M,`${o}/data/verifyCustomer`),he=O(Y,`${o}/data/buyData`),L=xe.getInitialState({customer:{...$},store:null,product:null,bundle:{...$}}),q=R({name:`${o}/data`,initialState:L,reducers:{setStore:(a,t)=>{a.store=t.payload===0?null:t.payload},setProduct:(a,t)=>{a.product=t.payload===0?null:t.payload},resetState:(a,t)=>{const n={user:()=>{a.user=L.user}}[t.payload];n&&n()}},extraReducers:a=>{E(a,V,"customer","customer"),E(a,he,"bundle","data")}}),{setStore:ge,resetState:_e,setProduct:G}=q.actions,pe=q.reducer,be={state:{state:!1,steps:0},kycDialog:!1,pinDialog:!1,query:{search:""}},K=R({name:`${o}/state`,initialState:be,reducers:{setState:(a,{payload:t})=>{a.state.state=t!==0,a.state.steps=t===0?0:t},setSearch:(a,{payload:t})=>{a.query.search=t},toggleKycDialog:(a,{payload:t})=>{a.kycDialog=t},togglePinDialog:(a,{payload:t})=>{a.pinDialog=t}}}),{setState:N,setSearch:$e,toggleKycDialog:Ee,togglePinDialog:je}=K.actions,ve=K.reducer,fe=z({state:ve,data:pe}),x=Q,Ne=T().shape({device_number:X().required("Please enter meter number")}),ye={device_number:""},Se=()=>{const a=j(),{store:t,customer:s,product:n}=x(r=>r[o].data),u=r=>{a(V(r))},i=B.useRef(me(u,1e3)).current;B.useEffect(()=>()=>{i.cancel()},[]);const l=r=>{i(r)},c=r=>{a(G({...n,...r})),a(N(2))};return e.jsxs(C,{loading:!1,children:[e.jsxs("div",{className:"inline-flex items-center cursor-pointer py-2 pr-2 mb-2",onClick:()=>{a(N(0))},children:[e.jsx(J,{})," Back"]}),e.jsx(U,{initialValues:ye,validationSchema:Ne,onSubmit:r=>c(r),children:({touched:r,errors:d,values:m})=>{var h,g,v,p,b,k,F,D,A;return e.jsx(W,{children:e.jsxs(Z,{children:[e.jsx(ee,{label:"Smart card number",invalid:d.device_number&&r.device_number,errorMessage:d.device_number,className:"xx:flex-1 xx:justify-between",children:e.jsx(ae,{name:"device_number",children:({field:I,form:P})=>e.jsx(se,{className:"xx:h-12",form:P,field:I,placeholder:"Smart card number",format:"###",onValueChange:y=>{if(P.setFieldValue(I.name,y.value),y.value.length>=11){const _={...t,device_number:y.value};console.log(_),l(_)}}})})}),((h=m==null?void 0:m.device_number)==null?void 0:h.length)>10&&e.jsx(e.Fragment,{children:(s==null?void 0:s.status)==="pending"?e.jsx(te,{size:35,className:"mx-auto mb-3"}):e.jsx(e.Fragment,{children:((s==null?void 0:s.status)==="success"||(s==null?void 0:s.status)==="error")&&e.jsx(ne,{className:"mb-4",type:(g=s==null?void 0:s.data)!=null&&g.success&&((p=(v=s==null?void 0:s.data)==null?void 0:v.data)!=null&&p.name)?"success":"danger",showIcon:!0,children:((k=(b=s==null?void 0:s.data)==null?void 0:b.data)==null?void 0:k.name)??(s==null?void 0:s.message)})})}),e.jsx(S,{variant:"solid",type:"submit",block:!0,className:"!bg-gray-900 hover:!bg-black",disabled:!((F=s==null?void 0:s.data)!=null&&F.success)&&!((A=(D=s==null?void 0:s.data)==null?void 0:D.data)!=null&&A.name),children:"Continue"})]})})}})]})},Ce=({operators:a})=>{var s;const t=j();return e.jsx(f,{className:"flex flex-col xx:grid xx:grid-cols-3 gap-3",onChange:n=>{t(ge({operatorID:n[0],bill:"television"}))},children:(s=a==null?void 0:a.data)==null?void 0:s.map((n,u)=>e.jsx(f.Item,{value:n.id,children:({ref:i,active:l,value:c,onSegmentItemClick:r,disabled:d})=>e.jsx(w,{ref:i,active:l,disabled:d,className:"bg-slate-50",onSegmentItemClick:r,variant:"plain",children:e.jsx("div",{className:"space-y-1 text-center",children:e.jsx("h6",{children:n==null?void 0:n.name})})})},n.id))})},ke=()=>{var l;const a=j(),t=ce(),{store:s,product:n}=x(c=>c[o].data),{hasPin:u}=x(c=>c.auth.user),i=()=>{u?a(je(!0)):t("/transaction-pin")};return e.jsx("div",{children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-base mb-2",children:"Your Order"}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Package:"}),e.jsx("p",{className:"text-sm font-semibold",children:n==null?void 0:n.package})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Smart Card Number:"}),e.jsx("p",{className:"text-sm font-semibold",children:n==null?void 0:n.device_number})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Subscription Cost:"}),e.jsx("p",{className:"text-sm font-semibold",children:`₦${(l=Number(n==null?void 0:n.amount))==null?void 0:l.toLocaleString()}`})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-8",children:[e.jsx(S,{block:!0,variant:"solid",color:"red-500",icon:e.jsx(re,{}),className:"",onClick:()=>a(N(1)),children:"Back"}),e.jsx(S,{block:!0,variant:"solid",icon:e.jsx(ie,{}),className:"!bg-gray-900 hover:!bg-black",onClick:i,children:"Confirm"})]})]})})},Fe=()=>{var l;const{store:a}=x(c=>c[o].data),{profile:t}=x(c=>c.auth.user),s=j(),{isFetching:n,data:u}=le(a),{products:i}=u||{};return e.jsx(C,{loading:n,children:e.jsx(f,{className:"grid grid-cols-pow gap-3",onChange:c=>{var d,m,h;const r=(d=i==null?void 0:i.data)==null?void 0:d.find(g=>g.id===c[0]);if(((m=r==null?void 0:r.meta)==null?void 0:m.fee)>(t==null?void 0:t.balance)){oe("Error","You do not have enough balance to complete this transaction, please top-up and try again.","danger",5e3);return}s(G({productID:c[0],bill:"television",operatorID:a==null?void 0:a.operatorID,amount:(h=r==null?void 0:r.meta)==null?void 0:h.fee,package:r==null?void 0:r.name})),s(N(1))},children:(l=i==null?void 0:i.data)==null?void 0:l.map((c,r)=>e.jsx(f.Item,{value:c.id,children:({ref:d,active:m,value:h,onSegmentItemClick:g,disabled:v})=>{var p,b;return e.jsx(w,{ref:d,active:m,disabled:v,className:"bg-slate-50",onSegmentItemClick:g,variant:"plain",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx("p",{children:c==null?void 0:c.name}),e.jsxs("h6",{children:["₦",(b=Number((p=c==null?void 0:c.meta)==null?void 0:p.fee))==null?void 0:b.toLocaleString()]})]})})}},c.id))})})};de(`${o}`,fe);const De=()=>{j();const{state:a}=x(c=>c[o].state),{store:t,product:s,customer:n}=x(c=>c[o].data),{data:u,isFetching:i}=ue("television"),{operators:l}=u||{};return console.log("Operators: ",l),console.log("State: ",a),console.log("Store: ",t),console.log("Product: ",s),console.log("Customer: ",n),e.jsx("div",{className:"p-4 mt-2",children:e.jsx(C,{loading:i,children:a.state?e.jsxs(e.Fragment,{children:[a.steps===1&&e.jsx(Se,{}),a.steps===2&&e.jsx(ke,{})]}):e.jsxs("div",{className:"grid gap-4",children:[e.jsx(Ce,{operators:l}),t&&e.jsx(Fe,{})]})})})},Be=De;export{Be as default};
