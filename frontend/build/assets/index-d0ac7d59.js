import{ce as A,a as $,c as u,o as I,p as E,j as e,L as C,B as _,F as B,v as G,w as T,x as F,y as M,I as V,co as q,a1 as D,G as H,a2 as z,a3 as L,u as Y,r as P,t as R,U as h,aq as g}from"./index-3595f095.js";import{s as U,a as W,b as J,c as K,d as Q,g as X}from"./index-769b6afe.js";function Z(n){return A({tag:"svg",attr:{viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}},{tag:"path",attr:{d:"M7 18v-10.948a1.05 1.05 0 0 1 1.968 -.51l6.064 10.916a1.05 1.05 0 0 0 1.968 -.51v-10.948"}},{tag:"path",attr:{d:"M5 10h14"}},{tag:"path",attr:{d:"M5 14h14"}}]})(n)}const ee=({onNext:n})=>{const r=$(),{airtime:t,gettingProducts:d,productStatus:c}=u(s=>s.airtime.data),{operator:x,selectedOperator:j}=u(s=>s.airtime.state),{profile:l}=u(s=>s.auth.user),m=I().shape({phone:E().matches(/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,"Phone number is not valid").required("Please enter your phone number"),amount:E().required("Please enter an amount")}),a={phone:"",amount:""},b=(s,o,i,p)=>{z.push(e.jsx(L,{title:i||"Error",type:o||"warning",duration:p||3e3,children:s}),{placement:"top-center"})},v=({phone:s,amount:o})=>{if(o>(l==null?void 0:l.balance)){b("You do not have enough balance to complete this transaction, please top-up and try again.","danger","Error",5e3);return}r(U({oid:x,operator:j,product:t==null?void 0:t.id,phone:s,amount:o})),n()};return e.jsx("div",{children:d?e.jsx("div",{className:"h-[10vh]",children:e.jsx(C,{size:32,loading:!0})}):c==="success"&&e.jsx(_.div,{initial:{opacity:0,visibility:"hidden"},animate:{opacity:1,visibility:"visible"},transition:{duration:.3,type:"tween"},exit:{opacity:0,visibility:"hidden"},children:e.jsx(B,{initialValues:a,validationSchema:m,onSubmit:s=>v(s),children:({touched:s,errors:o,values:i})=>{var p,y;return e.jsx(G,{children:e.jsxs(T,{children:[e.jsx(F,{label:"Enter Your Phone Number",invalid:o.phone&&s.phone,errorMessage:o.phone,children:e.jsx(M,{type:"text",autoComplete:"off",name:"phone",placeholder:"Phone number",component:V,prefix:e.jsx(q,{className:"text-xl"})})}),e.jsx(F,{label:"How Much Do You Want To Recharge?",invalid:o.amount&&s.amount,errorMessage:o.amount,children:e.jsx(M,{name:"amount",children:({field:f,form:w})=>{var S,O;return e.jsx(D,{thousandSeparator:!0,form:w,field:f,isAllowed:N=>{var k;return N.value<=Number((k=t==null?void 0:t.meta)==null?void 0:k.maximum_fee)},placeholder:`Amount between ₦${Number((S=t==null?void 0:t.meta)==null?void 0:S.minimum_fee).toLocaleString()} - ₦${Number((O=t==null?void 0:t.meta)==null?void 0:O.maximum_fee).toLocaleString()}`,decimalScale:0,value:f.value,inputPrefix:e.jsx(Z,{className:"text-2xl"}),onValueChange:N=>w.setFieldValue(f.name,N.floatValue)})}})}),e.jsx(H,{variant:"solid",type:"submit",block:!0,className:"!bg-gray-900 hover:!bg-black",disabled:!i.amount||!i.phone||i.amount<Number((p=t==null?void 0:t.meta)==null?void 0:p.minimum_fee)||i.amount>Number((y=t==null?void 0:t.meta)==null?void 0:y.maximum_fee),children:"Continue"})]})})}})})})},te=()=>{const n=Y(),r=$(),{operators:t,operatorStatus:d,productStatus:c,gettingOperators:x}=u(a=>a.airtime.data),{selectedOperator:j}=u(a=>a.airtime.state),l=a=>{r(K(a.name)),r(Q(a.id)),r(X({category:a.id}))},m=(a,b,v,s)=>{z.push(e.jsx(L,{title:v||"Error",type:b||"warning",duration:s||3e3,children:a}),{placement:"top-center"})};return P.useEffect(()=>{d==="error"&&(m("Oops! Something went wrong, please try again later.","danger","Error",5e3),r(W("idle")),n(-1))},[r,n,d]),P.useEffect(()=>{c==="error"&&(m("Oops! Something went wrong, please try again.","danger","Error",5e3),r(J("idle")))},[r,n,c]),e.jsx("div",{className:"mb-8",children:x?e.jsx("div",{className:"h-[10vh]",children:e.jsx(C,{size:32,loading:!0})}):e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-4",children:"Choose a Network Operator"}),e.jsx("div",{className:"flex items-center gap-4 justify-around flex-wrap",children:t==null?void 0:t.map(a=>e.jsxs("div",{className:R("flex flex-col gap-1 items-center cursor-pointer",c==="success"&&j===a.name&&"shadow-md px-4 py-2 bg-white rounded-lg border-b-2 border-primary-500"),onClick:()=>l(a),children:[a.name==="Airtel"&&e.jsx(h,{size:"lg",src:"/img/airtel.jpg",icon:e.jsx(g,{})}),a.name==="9Mobile"&&e.jsx(h,{className:"bg-white",size:"lg",src:"/img/9mobile.png",icon:e.jsx(g,{})}),a.name==="Glo"&&e.jsx(h,{className:"bg-white",size:"lg",src:"/img/Glo.png",icon:e.jsx(g,{})}),a.name==="MTN"&&e.jsx(h,{className:"bg-white",size:"lg",src:"/img/MTN.png",icon:e.jsx(g,{})}),e.jsx("p",{className:"text-sm",children:a.name})]},a.id))})]})})},ne=({onNext:n})=>e.jsxs("div",{children:[e.jsx(te,{onNext:n}),e.jsx(ee,{onNext:n})]});export{ne as default};
