import{z as J,at as Q,bS as X,bT as Y,j as c,bU as ee,a0 as w,bV as k,bW as u,r as b,a as te,u as ne,n as z,P as re,A as se,w as oe,L as ae,V as ie,W as ce}from"./index-508e130b.js";import{s as R,v as ue,a as le,u as fe}from"./index-f2bfb18d.js";import{u as me}from"./useTimeOutMessage-bfa14556.js";const L=J.forwardRef((n,r)=>{var _,E;const{asElement:s,size:t,inputSize:e,validationPattern:i=/[0-9]{1}/,value:a,onChange:o,className:f,...l}=n,{themeColor:m,controlSize:h,primaryColorLevel:d,direction:g}=Q(),v=(_=X())==null?void 0:_.size,P=(E=Y())==null?void 0:E.size,D=e||P||v||h,O=new Array(t).fill("-"),x=(T,S)=>{const p=T.target,N=T.target.value;if(!i.test(N)&&N!=="")return;const W=a.split("");W[S]=N;const q=W.join("").slice(0,6);if(o(q),N){const $=p.nextElementSibling||null;$==null||$.focus()}},C=T=>{const S=T.currentTarget;if(T.key==="ArrowLeft"||T.key==="Backspace"){const p=S.previousElementSibling||null;p==null||p.focus(),p==null||p.setSelectionRange(0,1);return}if(T.key==="ArrowRight"){const p=S.nextSibling||null;p==null||p.focus(),p==null||p.setSelectionRange(0,1);return}},y=T=>{T.preventDefault();const S=T.clipboardData.getData("text").substring(0,t);o(S)};return c.jsx("div",{className:"flex gap-2",children:O.map((T,S)=>c.jsx("input",{...l,className:f||`input focus:ring-${m}-${d} focus-within:ring-${m}-${d} focus-within:border-${m}-${d} focus:border-${m}-${d} px-0 text-center input-${D} h-${ee[D]}`,type:"text",inputMode:"numeric",autoComplete:"one-time-code",pattern:i.source,onInvalid:p=>p.target.setCustomValidity("Please enter a number."),maxLength:t,value:a.at(S)??"",onChange:p=>x(p,S),onKeyUp:C,onPaste:y},S))})});L.propTypes={asElement:w.string,type:w.string,className:w.string,size:w.oneOf([4,6,8]),inputSize:w.oneOf([k.LG,k.SM,k.MD]),value:w.any};L.defaultProps={type:"text",asElement:"input",className:""};function V(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}function H(n,r){for(var s=0;s<r.length;s++){var t=r[s];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function F(n,r,s){return r&&H(n.prototype,r),s&&H(n,s),n}function G(n,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(r&&r.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),r&&I(n,r)}function M(n){return M=Object.setPrototypeOf?Object.getPrototypeOf:function(s){return s.__proto__||Object.getPrototypeOf(s)},M(n)}function I(n,r){return I=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},I(n,r)}function pe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function de(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function he(n,r){return r&&(typeof r=="object"||typeof r=="function")?r:de(n)}function B(n){var r=pe();return function(){var t=M(n),e;if(r){var i=M(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return he(this,e)}}function ye(n){return ve(n)||ge(n)||Te(n)||Se()}function ve(n){if(Array.isArray(n))return A(n)}function ge(n){if(typeof Symbol<"u"&&Symbol.iterator in Object(n))return Array.from(n)}function Te(n,r){if(n){if(typeof n=="string")return A(n,r);var s=Object.prototype.toString.call(n).slice(8,-1);if(s==="Object"&&n.constructor&&(s=n.constructor.name),s==="Map"||s==="Set")return Array.from(n);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return A(n,r)}}function A(n,r){(r==null||r>n.length)&&(r=n.length);for(var s=0,t=new Array(r);s<r;s++)t[s]=n[s];return t}function Se(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function j(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,s=String(n);if(r===0)return s;var t=s.match(/(.*?)([0-9]+)(.*)/),e=t?t[1]:"",i=t?t[3]:"",a=t?t[2]:s,o=a.length>=r?a:(ye(Array(r)).map(function(){return"0"}).join("")+a).slice(r*-1);return"".concat(e).concat(o).concat(i)}var K={daysInHours:!1,zeroPadTime:2};function be(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=r.now,t=s===void 0?Date.now:s,e=r.precision,i=e===void 0?0:e,a=r.controlled,o=r.offsetTime,f=o===void 0?0:o,l=r.overtime,m;typeof n=="string"?m=new Date(n).getTime():n instanceof Date?m=n.getTime():m=n,a||(m+=f);var h=a?m:m-t(),d=Math.min(20,Math.max(0,i)),g=Math.round(parseFloat(((l?h:Math.max(0,h))/1e3).toFixed(d))*1e3),v=Math.abs(g)/1e3;return{total:g,days:Math.floor(v/(3600*24)),hours:Math.floor(v/3600%24),minutes:Math.floor(v/60%60),seconds:Math.floor(v%60),milliseconds:Number((v%1*1e3).toFixed()),completed:g<=0}}function Pe(n,r){var s=n.days,t=n.hours,e=n.minutes,i=n.seconds,a=Object.assign(Object.assign({},K),r),o=a.daysInHours,f=a.zeroPadTime,l=a.zeroPadDays,m=l===void 0?f:l,h=Math.min(2,f),d=o?j(t+s*24,f):j(t,h);return{days:o?"":j(s,m),hours:d,minutes:j(e,h),seconds:j(i,h)}}var Z=function(n){G(s,n);var r=B(s);function s(){var t;return V(this,s),t=r.apply(this,arguments),t.state={count:t.props.count||3},t.startCountdown=function(){t.interval=window.setInterval(function(){var e=t.state.count-1;e===0?(t.stopCountdown(),t.props.onComplete&&t.props.onComplete()):t.setState(function(i){return{count:i.count-1}})},1e3)},t.stopCountdown=function(){clearInterval(t.interval)},t.addTime=function(e){t.stopCountdown(),t.setState(function(i){return{count:i.count+e}},t.startCountdown)},t}return F(s,[{key:"componentDidMount",value:function(){this.startCountdown()}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"render",value:function(){return this.props.children?b.cloneElement(this.props.children,{count:this.state.count}):null}}]),s}(b.Component);Z.propTypes={count:u.number,children:u.element,onComplete:u.func};var U=function(n){G(s,n);var r=B(s);function s(t){var e;if(V(this,s),e=r.call(this,t),e.mounted=!1,e.initialTimestamp=e.calcOffsetStartTimestamp(),e.offsetStartTimestamp=e.props.autoStart?0:e.initialTimestamp,e.offsetTime=0,e.legacyMode=!1,e.legacyCountdownRef=b.createRef(),e.tick=function(){var a=e.calcTimeDelta(),o=a.completed&&!e.props.overtime?void 0:e.props.onTick;e.setTimeDeltaState(a,void 0,o)},e.start=function(){if(!e.isStarted()){var a=e.offsetStartTimestamp;e.offsetStartTimestamp=0,e.offsetTime+=a?e.calcOffsetStartTimestamp()-a:0;var o=e.calcTimeDelta();e.setTimeDeltaState(o,"STARTED",e.props.onStart),!e.props.controlled&&(!o.completed||e.props.overtime)&&(e.clearTimer(),e.interval=window.setInterval(e.tick,e.props.intervalDelay))}},e.pause=function(){e.isPaused()||(e.clearTimer(),e.offsetStartTimestamp=e.calcOffsetStartTimestamp(),e.setTimeDeltaState(e.state.timeDelta,"PAUSED",e.props.onPause))},e.stop=function(){e.isStopped()||(e.clearTimer(),e.offsetStartTimestamp=e.calcOffsetStartTimestamp(),e.offsetTime=e.offsetStartTimestamp-e.initialTimestamp,e.setTimeDeltaState(e.calcTimeDelta(),"STOPPED",e.props.onStop))},e.isStarted=function(){return e.isStatus("STARTED")},e.isPaused=function(){return e.isStatus("PAUSED")},e.isStopped=function(){return e.isStatus("STOPPED")},e.isCompleted=function(){return e.isStatus("COMPLETED")},t.date){var i=e.calcTimeDelta();e.state={timeDelta:i,status:i.completed?"COMPLETED":"STOPPED"}}else e.legacyMode=!0;return e}return F(s,[{key:"componentDidMount",value:function(){this.legacyMode||(this.mounted=!0,this.props.onMount&&this.props.onMount(this.calcTimeDelta()),this.props.autoStart&&this.start())}},{key:"componentDidUpdate",value:function(e){this.legacyMode||this.props.date!==e.date&&(this.initialTimestamp=this.calcOffsetStartTimestamp(),this.offsetStartTimestamp=this.initialTimestamp,this.offsetTime=0,this.setTimeDeltaState(this.calcTimeDelta()))}},{key:"componentWillUnmount",value:function(){this.legacyMode||(this.mounted=!1,this.clearTimer())}},{key:"calcTimeDelta",value:function(){var e=this.props,i=e.date,a=e.now,o=e.precision,f=e.controlled,l=e.overtime;return be(i,{now:a,precision:o,controlled:f,offsetTime:this.offsetTime,overtime:l})}},{key:"calcOffsetStartTimestamp",value:function(){return Date.now()}},{key:"addTime",value:function(e){this.legacyCountdownRef.current.addTime(e)}},{key:"clearTimer",value:function(){window.clearInterval(this.interval)}},{key:"isStatus",value:function(e){return this.state.status===e}},{key:"setTimeDeltaState",value:function(e,i,a){var o=this;if(this.mounted){var f=e.completed&&!this.state.timeDelta.completed,l=e.completed&&i==="STARTED";f&&!this.props.overtime&&this.clearTimer();var m=function(){a&&a(o.state.timeDelta),o.props.onComplete&&(f||l)&&o.props.onComplete(e,l)};return this.setState(function(h){var d=i||h.status;return e.completed&&!o.props.overtime?d="COMPLETED":!i&&d==="COMPLETED"&&(d="STOPPED"),{timeDelta:e,status:d}},m)}}},{key:"getApi",value:function(){return this.api=this.api||{start:this.start,pause:this.pause,stop:this.stop,isStarted:this.isStarted,isPaused:this.isPaused,isStopped:this.isStopped,isCompleted:this.isCompleted}}},{key:"getRenderProps",value:function(){var e=this.props,i=e.daysInHours,a=e.zeroPadTime,o=e.zeroPadDays,f=this.state.timeDelta;return Object.assign(Object.assign({},f),{api:this.getApi(),props:this.props,formatted:Pe(f,{daysInHours:i,zeroPadTime:a,zeroPadDays:o})})}},{key:"render",value:function(){if(this.legacyMode){var e=this.props,i=e.count,a=e.children,o=e.onComplete;return b.createElement(Z,{ref:this.legacyCountdownRef,count:i,onComplete:o},a)}var f=this.props,l=f.className,m=f.overtime,h=f.children,d=f.renderer,g=this.getRenderProps();if(d)return d(g);if(h&&this.state.timeDelta.completed&&!m)return b.cloneElement(h,{countdown:g});var v=g.formatted,P=v.days,D=v.hours,O=v.minutes,x=v.seconds;return b.createElement("span",{className:l},g.total<0?"-":"",P,P?":":"",D,":",O,":",x)}}]),s}(b.Component);U.defaultProps=Object.assign(Object.assign({},K),{controlled:!1,intervalDelay:1e3,precision:0,autoStart:!0});U.propTypes={date:u.oneOfType([u.instanceOf(Date),u.string,u.number]),daysInHours:u.bool,zeroPadTime:u.number,zeroPadDays:u.number,controlled:u.bool,intervalDelay:u.number,precision:u.number,autoStart:u.bool,overtime:u.bool,className:u.string,children:u.element,renderer:u.func,now:u.func,onMount:u.func,onStart:u.func,onPause:u.func,onStop:u.func,onTick:u.func,onComplete:u.func};const Oe=({onBack:n})=>{var x,C;const r=te(),s=ne(),[t,e]=b.useState(""),[i,a]=me(),{profile:o}=z(y=>y.auth.user),{resent:f}=z(y=>y.verify.state),{status:l,verifyMessage:m,verifying:h,resending:d,timer:g}=z(y=>y.verify.data);b.useEffect(()=>{const y=()=>{ie.push(c.jsx(ce,{title:`${l==="success"?"Success":"Error"}`,type:`${l==="success"?"success":"danger"}`,duration:2e3,children:l==="success"?"Phone number verified successfully!":"Looks like something went wrong, please try again."}),{placement:"top-center"})};(l==="success"||l==="error")&&(a(m),e(""),y(),r(re()))},[r,s,a,l,m]),b.useEffect(()=>{l==="success"&&s("/home")},[s,l]);const v=()=>{r(R(!0)),r(le(!0)),r(fe({phone:o==null?void 0:o.phone}))},P=()=>{r(R(!1)),r(ue({phone:o==null?void 0:o.phone,otp:t}))},D=()=>{r(R(!0)),n()},O=({minutes:y,seconds:_,completed:E})=>E?c.jsx("span",{onClick:()=>v(),className:"font-bold text-gray-700 underline cursor-pointer",children:"Resend OTP"}):c.jsxs("span",{className:"font-bold text-gray-700",children:["Wait ",y,":",_," mins"]});return c.jsx("div",{className:"h-full flex flex-col justify-center p-6",children:c.jsxs("div",{className:"w-full flex flex-col gap-4 justify-center",children:[c.jsx("div",{className:"w-full flex justify-center items-center",children:c.jsx("img",{className:"w-72",src:"/img/signup.png",alt:""})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-center mt-4 text-2xl font-bold",children:"Verify Phone Number"}),f?c.jsxs("p",{className:"font-semibold text-center text-gray-400",children:["We have sent a new OTP to ",(x=o==null?void 0:o.phone)==null?void 0:x.replace(/(\d{3})(\d{4})(\d{3})(\d{4})/,"$1 $2 $3 $4")]}):c.jsxs("p",{className:"font-semibold text-center text-gray-400",children:["Enter the OTP code sent to ",(C=o==null?void 0:o.phone)==null?void 0:C.replace(/(\d{3})(\d{4})(\d{3})(\d{4})/,"$1 $2 $3 $4")]})]}),c.jsxs("div",{className:"mt-4",children:[i&&c.jsx(se,{className:"mb-4",type:l==="error"?"danger":"success",showIcon:!0,children:i}),c.jsx("form",{onSubmit:async y=>{y.preventDefault(),P()},children:c.jsxs("div",{className:"grid place-content-center bg-base-100 max-w-sm mx-auto",children:[c.jsx(L,{inputSize:"lg",size:4,value:t,onChange:y=>{e(y)}}),c.jsx(oe,{className:"mt-8",block:!0,variant:"solid",type:"submit",disabled:(t==null?void 0:t.length)<4,loading:h,children:"Verify & Proceed"}),c.jsxs("div",{className:"mt-4",children:[c.jsxs("p",{className:"text-gray-400 text-center font-semibold flex w-full justify-center gap-2",children:["Didn't receive the OTP? "," ",d?c.jsx("span",{className:"inline",children:c.jsx(ae,{size:22,loading:!0})}):c.jsx(U,{date:g?Date.now()+9e4:Date.now(),renderer:O})]}),c.jsx("p",{onClick:()=>D(),className:"font-bold text-gray-700 text-center underline cursor-pointer mt-2",children:"Wrong phone number?"})]})]})})]})]})})};export{Oe as default};
