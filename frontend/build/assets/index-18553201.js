import{h as ne,a as I,r as x,c as h,cw as Z,bA as H,K as L,bD as _,cx as U,bE as J,j as e,D as se,w as te,y as Y,$ as K,a0 as T,cy as oe,cz as k,c6 as ae,cA as de,v as D,z as ue,M as $,ap as E,cB as G,cC as he,S as p,cD as ee,cE as fe,i as me,cF as xe,E as pe,cG as ve,cH as je}from"./index-43834327.js";import{B as we}from"./BillsComponent-e7004d01.js";import{u as ie,s as W,i as ce}from"./sendPushNotification-7eac359c.js";import{B as ge}from"./index-47a792bb.js";const le=ne({name:"dashboard/state",initialState:{startServiceDialog:!1,startService:!1,completeServiceDialog:!1,completeService:!1,confirmServiceDialog:!1,confirmService:!1,cancelServiceDialog:!1,cancelService:!1,openDisputeDialog:!1,openDispute:!1,bookingID:null},reducers:{setBookingID:(s,a)=>{s.bookingID=a.payload},setOpenDispute:(s,a)=>{s.openDispute=a.payload},setStartService:(s,a)=>{s.startService=a.payload},setCancelService:(s,a)=>{s.cancelService=a.payload},setConfirmService:(s,a)=>{s.confirmService=a.payload},setCompleteService:(s,a)=>{s.completeService=a.payload},toggleOpenDisputeDialog:(s,a)=>{s.openDisputeDialog=a.payload},toggleStartServiceDialog:(s,a)=>{s.startServiceDialog=a.payload},toggleCancelServiceDialog:(s,a)=>{s.cancelServiceDialog=a.payload},toggleCompleteServiceDialog:(s,a)=>{s.completeServiceDialog=a.payload},toggleConfirmServiceDialog:(s,a)=>{s.confirmServiceDialog=a.payload}}}),{setBookingID:R,setOpenDispute:Ae,setStartService:Ie,setCancelService:Pe,setConfirmService:Le,setCompleteService:Fe,toggleOpenDisputeDialog:V,toggleStartServiceDialog:M,toggleCancelServiceDialog:Q,toggleConfirmServiceDialog:Ue,toggleCompleteServiceDialog:X}=le.actions,ye=le.reducer,Se=()=>{var P,q;const s=I(),[a,r]=x.useState(""),[t,f]=x.useState(!1),[w,o]=ie(),{cancellingService:u,cancelStatus:m,booking:i}=h(v=>v.dashboard.data),{cancelServiceDialog:j,bookingID:C}=h(v=>v.dashboard.state),{profile:y}=h(v=>v.auth.user),{createStatus:c,notification:l}=h(v=>v.notifications.data),g={receiver_id:i==null?void 0:i.user_id,type:"booking cancelled",data:JSON.stringify({message:`${(P=y==null?void 0:y.service)==null?void 0:P.title} has cancelled this service request, your refund will be processed shortly.`,invoice_number:(q=i==null?void 0:i.invoice)==null?void 0:q.invoice_number,booking_id:i==null?void 0:i.id}),url:"/requests"},d=(v,N,O,z)=>{K.push(e.jsx(T,{title:O||"Error",type:N||"warning",duration:z||3e3,children:v}),{placement:"top-center"})};x.useEffect(()=>{a.length!==0&&t&&f(!1)},[a,t]),x.useEffect(()=>{m==="error"&&(d("Oops! Something went wrong, please try again.","danger","Error",4e3),s(Z("idle"))),m==="reason error"&&d("Please let us know why you are cancelling this request.","danger","Error",4e3)},[m,s]),x.useEffect(()=>{var v,N,O,z;m==="success"&&(s(H(g)),W({app_id:"9749386f-0c3b-417c-b986-3447a73296cd",channel_for_external_user_ids:"push",include_external_user_ids:[`${(v=i==null?void 0:i.user)==null?void 0:v.id}`],url:`${L.appURL}/requests`,contents:{en:`Hello ${(N=i==null?void 0:i.user)==null?void 0:N.username}, ${y==null?void 0:y.username} has cancelled the service #${(O=i==null?void 0:i.invoice)==null?void 0:O.invoice_number}, your refund will be processed shortly.`},content_available:!0}),d("Service cancelled.","success","Success",8e3)),s(Q(!1)),s(R(null)),_.emit("cancelledService",(z=i==null?void 0:i.user)==null?void 0:z.id),s(U()),s(Z("idle"))},[m]),x.useEffect(()=>{c==="success"&&(_.emit("sendNotification",[l,i==null?void 0:i.user_id]),s(J("idle")))},[c]);const n=v=>{var N;r((N=v.target)==null?void 0:N.value)},b=()=>{if(a.length<1){f(!0),o();return}s(oe({booking_id:C,reason:a}))},A=()=>{s(Q(!1)),s(R(null))};return e.jsxs(se,{isOpen:j,onClose:A,onRequestClose:A,type:"info",title:"Are You Sure You Want to Cancel This Service?",onCancel:A,onConfirm:b,loading:u,children:[e.jsx("h4",{className:"text-lg font-bold text-gray-700",children:"You are about to cancel this request"}),e.jsxs("div",{className:"mt-4",children:[e.jsx(ce,{className:"w-full block text-sm outline-none p-3 bg-gray-200 overflow-auto resize-none rounded-md border-0 active:border-0",onChange:n,value:a,placeholder:"Kindly tell us why you want to cancel this service request.",maxRows:10,minRows:5,ref:w}),t&&e.jsx(te.p,{initial:{opacity:0,visibility:"hidden"},animate:{opacity:1,visibility:"visible"},transition:{duration:.3,type:"tween"},exit:{opacity:0,visibility:"hidden"},className:"text-xs text-red-500 mt-2",children:"Please kindly tell us why you are cancelling this service request"}),e.jsxs("div",{className:"flex items-center gap-4 w-full justify-end mt-4",children:[e.jsx(Y,{className:"!bg-white",onClick:A,children:"Cancel"}),e.jsx(Y,{variant:"solid",color:"red-500",onClick:b,loading:u,children:"Confirm"})]})]})]})},Ce=()=>{var c;const s=I(),{completingService:a,serviceStatus:r,booking:t}=h(l=>l.dashboard.data),{completeServiceDialog:f,bookingID:w}=h(l=>l.dashboard.state),{profile:o}=h(l=>l.auth.user),{createStatus:u,notification:m}=h(l=>l.notifications.data),i={receiver_id:t==null?void 0:t.user_id,type:"booking complete",data:JSON.stringify({message:`${(c=o==null?void 0:o.service)==null?void 0:c.title} has completed your service, please inspect the work and confirm if you are satisfied.`,booking_id:t==null?void 0:t.id}),url:"/requests"},j=(l,g,d,n)=>{K.push(e.jsx(T,{title:d||"Error",type:g||"warning",duration:n||3e3,children:l}),{placement:"top-center"})};x.useEffect(()=>{r==="error"&&j("Oops! Something went wrong, please try again.","danger","Error",4e3),s(k("idle"))},[r,s]),x.useEffect(()=>{var l,g,d;r==="success"&&(s(H(i)),W({app_id:"9749386f-0c3b-417c-b986-3447a73296cd",channel_for_external_user_ids:"push",include_external_user_ids:[`${(l=t==null?void 0:t.user)==null?void 0:l.id}`],url:`${L.appURL}/chat/${o==null?void 0:o.username.toLowerCase()}`,contents:{en:`Hello ${(g=t==null?void 0:t.user)==null?void 0:g.username}, ${o==null?void 0:o.username} has completed your service, please inspect the work and confirm if you are satisfied.`},content_available:!0}),j("We have notified the user that booked this service that it has been completed, please wait a moment for them to confirm.","success","Success",8e3)),s(X(!1)),s(k("idle")),_.emit("completedService",(d=t==null?void 0:t.user)==null?void 0:d.id,console.log("Emit Service Completed, Dashboard: ",!0))},[r]),x.useEffect(()=>{u==="success"&&(_.emit("sendNotification",[m,t==null?void 0:t.user_id]),s(J("idle")))},[u]);const C=()=>{s(X(!1))},y=()=>{s(de({booking_id:w}))};return e.jsx(ae,{isOpen:f,onClose:C,onRequestClose:C,type:"success",title:"Service Completed?",onCancel:C,onConfirm:y,loading:a,children:e.jsx("p",{children:"Confirm that you have successfully completed this service?"})})},De=({bookingsCount:s,profile:a})=>{var r;return e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-1/2 min-w-[18rem] h-40",bodyClass:"h-full",children:e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 justify-center items-center",children:[e.jsx("h4",{className:"text-gray-600",children:"All Profile Views"}),e.jsx("h4",{className:"font-semibold",children:(r=a==null?void 0:a.profile_views)==null?void 0:r.toLocaleString()})]})}),e.jsx(D,{className:"w-1/2 min-w-[18rem] h-40",bodyClass:"h-full",children:e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 justify-center items-center",children:[e.jsx("h4",{className:"text-gray-600",children:"All Service Requests"}),e.jsx("h4",{className:"font-semibold",children:s==null?void 0:s.toLocaleString()})]})})]})},Ne=({data:s,imagePath:a})=>{const r=s==null?void 0:s.filter(t=>{var f;return((f=t.messages)==null?void 0:f.length)>0});return e.jsx(e.Fragment,{children:(r==null?void 0:r.length)<1?e.jsx("div",{className:"min-h-[20vh] w-full flex flex-col justify-center",children:e.jsxs("p",{className:"text-center text-gray-400 font-bold text-2xl",children:["You don't have ",e.jsx("br",{})," any unanswered chats..."]})}):e.jsx(e.Fragment,{children:r==null?void 0:r.map(t=>{var f,w,o,u,m;return e.jsx(ue,{to:`/chat/${(f=t.user)==null?void 0:f.slug}`,state:{chat:t.id},children:e.jsxs(D,{className:"min-w-[10rem] w-40",bodyClass:"flex w-full flex-col justify-center items-center",children:[e.jsx($,{size:"lg",shape:"circle",icon:e.jsx(E,{}),src:(w=t.user)!=null&&w.image?`${a}/${(o=t.user)==null?void 0:o.image}`:null}),e.jsx("h4",{className:"font-semibold text-base",children:`${(u=t==null?void 0:t.user)==null?void 0:u.first_name} ${(m=t==null?void 0:t.user)==null?void 0:m.last_name}`})]})},t.id)})})})},_e=()=>{const s=I(),{imagePath:a}=L,{enquiries:r,bookings:t,bookingsCount:f,booking:w,completingService:o,confirmingService:u}=h(n=>n.dashboard.data),{bookingID:m}=h(n=>n.dashboard.state),{profile:i,userType:j}=h(n=>n.auth.user),C=j==="Provider",y=r==null?void 0:r.filter(n=>n.messages.every(b=>b.sender_id!==(i==null?void 0:i.id))),c=n=>{s(V(!0)),s(R(n==null?void 0:n.id))},l=n=>{s(X(!0)),s(R(n==null?void 0:n.id))},g=n=>{s(M(!0)),s(R(n==null?void 0:n.id))},d=n=>{s(Q(!0)),s(R(n==null?void 0:n.id))};return e.jsxs("div",{children:[e.jsx("h4",{children:"Active Bookings"}),e.jsx("div",{className:"mt-4 mb-4",children:e.jsx(ge,{imagePath:a,bookings:t,isProvider:C,booking:w,completingService:o,confirmingService:u,bookingID:m,onComplete:l,onStart:g,onCancel:d,onReport:c})}),e.jsx("h4",{children:"Unanswered Request Chats"}),e.jsx("div",{className:"mt-4 mb-4 flex gap-4 overflow-auto pb-4",children:e.jsx(Ne,{data:y,imagePath:a})}),e.jsx("div",{className:"mt-4 mb-4 w-full flex items-center gap-4 overflow-auto pb-4",children:e.jsx(De,{bookingsCount:f,profile:i})})]})},be=()=>{var v,N,O,z;const s=I(),[a,r]=x.useState(""),[t,f]=x.useState(!1),[w,o]=ie(),{openingDispute:u,disputeStatus:m,booking:i,dispute:j}=h(S=>S.dashboard.data),{openDisputeDialog:C,bookingID:y}=h(S=>S.dashboard.state),{profile:c}=h(S=>S.auth.user),{createStatus:l,notification:g}=h(S=>S.notifications.data),d=i==null?void 0:i.user,n={receiver_id:d==null?void 0:d.id,type:"booking disputed",data:JSON.stringify({message:`${(v=c==null?void 0:c.service)!=null&&v.title?(N=c==null?void 0:c.service)==null?void 0:N.title:`${c==null?void 0:c.first_name} ${c==null?void 0:c.last_name}`} has opened dispute on the service request #${(O=i==null?void 0:i.invoice)==null?void 0:O.invoice_number}, you have 24hrs to respond.`,invoice_number:(z=i==null?void 0:i.invoice)==null?void 0:z.invoice_number,booking_id:i==null?void 0:i.id}),url:`/requests/disputes/${j==null?void 0:j.id}`},b=(S,B,F,re)=>{K.push(e.jsx(T,{title:F||"Error",type:B||"warning",duration:re||3e3,children:S}),{placement:"top-center"})};x.useEffect(()=>{a.length!==0&&t&&f(!1)},[a,t]),x.useEffect(()=>{m==="error"&&(b("Oops! Something went wrong, please try again.","danger","Error",4e3),s(G("idle"))),m==="reason error"&&(b("Please let us know why you want to lodge a complaint.","danger","Error",4e3),s(G("idle")))},[s,m]),x.useEffect(()=>{var S,B,F;m==="success"&&(s(H(n)),W({app_id:"9749386f-0c3b-417c-b986-3447a73296cd",channel_for_external_user_ids:"push",include_external_user_ids:[`${d==null?void 0:d.id}`],url:`${L.appURL}/requests/disputes/${j==null?void 0:j.id}`,contents:{en:`${(S=c==null?void 0:c.service)!=null&&S.title?(B=c==null?void 0:c.service)==null?void 0:B.title:`${c==null?void 0:c.first_name} ${c==null?void 0:c.last_name}`} has opened dispute on the service request #${(F=i==null?void 0:i.invoice)==null?void 0:F.invoice_number}, you have 24hrs to respond.`},content_available:!0}),b("Service in dispute.","success","Success",8e3)),s(V(!1)),s(R(null)),_.emit("openedDispute",d==null?void 0:d.id),s(U()),s(G("idle"))},[m]),x.useEffect(()=>{l==="success"&&(_.emit("sendNotification",[g,d==null?void 0:d.id]),s(J("idle")))},[l]);const A=S=>{var B;r((B=S.target)==null?void 0:B.value)},P=()=>{if(a.length<1){f(!0),o();return}s(he({booking_id:y,reason:a}))},q=()=>{s(V(!1)),s(R(null))};return e.jsxs(se,{isOpen:C,onClose:q,onRequestClose:q,type:"info",title:"Are You Sure You Want to Report This Service Request?",onCancel:q,onConfirm:P,loading:u,children:[e.jsx("h4",{className:"text-lg font-bold text-gray-700",children:"You are about to report this service request"}),e.jsxs("div",{className:"mt-4",children:[e.jsx(ce,{className:"w-full block text-sm outline-none p-3 bg-gray-200 overflow-auto resize-none rounded-md border-0 active:border-0",onChange:A,value:a,placeholder:"Kindly tell us what you are dissatisfied about.",maxRows:10,minRows:5,ref:w}),t&&e.jsx(te.p,{initial:{opacity:0,visibility:"hidden"},animate:{opacity:1,visibility:"visible"},transition:{duration:.3,type:"tween"},exit:{opacity:0,visibility:"hidden"},className:"text-xs text-red-500 mt-2",children:"Please kindly tell us what you are dissatisfied about"}),e.jsxs("div",{className:"flex items-center gap-4 w-full justify-end mt-4",children:[e.jsx(Y,{className:"!bg-white",onClick:q,children:"Cancel"}),e.jsx(Y,{variant:"solid",color:"red-500",onClick:P,loading:u,children:"Confirm"})]})]})]})},$e=()=>e.jsxs("div",{children:[e.jsx("h4",{children:"Active Bookings"}),e.jsxs("div",{className:"mt-4 mb-4 flex gap-4 overflow-auto pb-4",children:[e.jsx(D,{className:"min-w-[18rem] w-80",bodyClass:"flex w-full flex-col justify-center items-center",children:e.jsxs("div",{className:"w-full flex items-center gap-4",children:[e.jsxs("div",{className:"w-1/2 flex flex-col items-center",children:[e.jsx($,{size:"lg",shape:"circle",icon:e.jsx(E,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(p,{width:"80%"}),e.jsx(p,{width:"100%"})]})]}),e.jsx(p,{width:"50%",height:"30px"})]})}),e.jsx(D,{className:"min-w-[18rem] w-80",bodyClass:"flex w-full flex-col justify-center items-center",children:e.jsxs("div",{className:"w-full flex items-center gap-4",children:[e.jsxs("div",{className:"w-1/2 flex flex-col items-center",children:[e.jsx($,{size:"lg",shape:"circle",icon:e.jsx(E,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(p,{width:"80%"}),e.jsx(p,{width:"100%"})]})]}),e.jsx(p,{width:"50%",height:"30px"})]})}),e.jsx(D,{className:"min-w-[18rem] w-80",bodyClass:"flex w-full flex-col justify-center items-center",children:e.jsxs("div",{className:"w-full flex items-center gap-4",children:[e.jsxs("div",{className:"w-1/2 flex flex-col items-center",children:[e.jsx($,{size:"lg",shape:"circle",icon:e.jsx(E,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(p,{width:"80%"}),e.jsx(p,{width:"100%"})]})]}),e.jsx(p,{width:"50%",height:"30px"})]})})]}),e.jsx("h4",{children:"Unanswered Request Chats"}),e.jsxs("div",{className:"mt-4 mb-4 flex gap-4 overflow-auto pb-4",children:[e.jsxs(D,{className:"min-w-[10rem] w-40",bodyClass:"flex w-full flex-col justify-center items-center",children:[e.jsx($,{size:"lg",shape:"circle",icon:e.jsx(E,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(p,{width:"80%"}),e.jsx(p,{width:"100%"})]})]}),e.jsxs(D,{className:"min-w-[10rem] w-40",bodyClass:"flex w-full flex-col justify-center items-center",children:[e.jsx($,{size:"lg",shape:"circle",icon:e.jsx(E,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(p,{width:"80%"}),e.jsx(p,{width:"100%"})]})]}),e.jsxs(D,{className:"min-w-[10rem] w-40",bodyClass:"flex w-full flex-col justify-center items-center",children:[e.jsx($,{size:"lg",shape:"circle",icon:e.jsx(E,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(p,{width:"80%"}),e.jsx(p,{width:"100%"})]})]}),e.jsxs(D,{className:"min-w-[10rem] w-40",bodyClass:"flex w-full flex-col justify-center items-center",children:[e.jsx($,{size:"lg",shape:"circle",icon:e.jsx(E,{})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1 justify-center items-center w-full",children:[e.jsx(p,{width:"80%"}),e.jsx(p,{width:"100%"})]})]})]}),e.jsxs("div",{className:"mt-4 mb-4 w-full flex items-center gap-4 overflow-auto pb-4",children:[e.jsx(D,{className:"w-1/2 min-w-[18rem] h-40",bodyClass:"h-full",children:e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 justify-center items-center",children:[e.jsx("h4",{children:"All Profile Views"}),e.jsx(p,{width:"30%",height:"15px"})]})}),e.jsx(D,{className:"w-1/2 min-w-[18rem] h-40",bodyClass:"h-full",children:e.jsxs("div",{className:"w-full h-full flex flex-col gap-4 justify-center items-center",children:[e.jsx("h4",{children:"All Service Requests"}),e.jsx(p,{width:"30%",height:"15px"})]})})]})]}),Ee=()=>{var c;const s=I(),{startingService:a,startStatus:r,booking:t}=h(l=>l.dashboard.data),{startServiceDialog:f,bookingID:w}=h(l=>l.dashboard.state),{profile:o}=h(l=>l.auth.user),{createStatus:u,notification:m}=h(l=>l.notifications.data),i={receiver_id:t==null?void 0:t.user_id,type:"booking start",data:JSON.stringify({message:`${(c=o==null?void 0:o.service)==null?void 0:c.title} has resumed your service.`,booking_id:t==null?void 0:t.id}),url:"/requests"},j=(l,g,d,n)=>{K.push(e.jsx(T,{title:d||"Error",type:g||"warning",duration:n||3e3,children:l}),{placement:"top-center"})};x.useEffect(()=>{r==="error"&&j("Oops! Something went wrong, please try again.","danger","Error",4e3),s(ee("idle"))},[r,s]),x.useEffect(()=>{var l,g,d;r==="success"&&(s(H(i)),W({app_id:"9749386f-0c3b-417c-b986-3447a73296cd",channel_for_external_user_ids:"push",include_external_user_ids:[`${(l=t==null?void 0:t.user)==null?void 0:l.id}`],url:`${L.appURL}/chat/${o==null?void 0:o.username.toLowerCase()}`,contents:{en:`Hello ${(g=t==null?void 0:t.user)==null?void 0:g.username}, ${o==null?void 0:o.username} has officially resumed service, we will let you know when he is done.`},content_available:!0}),j("Service resumed.","success","Success",8e3)),s(M(!1)),s(ee("idle")),_.emit("startedService",(d=t==null?void 0:t.user)==null?void 0:d.id,console.log("Emit Service Started, Bookings: ",!0))},[r]),x.useEffect(()=>{u==="success"&&(_.emit("sendNotification",[m,t==null?void 0:t.user_id]),s(J("idle")))},[u]);const C=()=>{s(M(!1))},y=()=>{s(fe({booking_id:w}))};return e.jsx(ae,{isOpen:f,onClose:C,onRequestClose:C,type:"success",title:"Start Service?",onCancel:C,onConfirm:y,loading:a,children:e.jsx("p",{children:"Officially resume this service?"})})},Re=me({state:ye,data:xe});pe("dashboard",Re);const Ye=()=>{const s=I(),{serviceCompleted:a,serviceConfirmed:r,serviceStarted:t,serviceCancelled:f}=h(u=>u.dashboard.data),{serviceBooked:w}=h(u=>u.chat.data),{loading:o}=h(u=>u.dashboard.data);return x.useEffect(()=>{s(U())},[s]),x.useEffect(()=>{(a||r||w||t||f)&&s(U()),a?s(ve(!1)):r&&s(je(!1))},[s,a,r,w,t,f]),e.jsxs("div",{className:"mt-10 mb-8 px-4",children:[o?e.jsx($e,{}):e.jsx(_e,{}),e.jsx(we,{}),e.jsx(Ce,{socket:_.current}),e.jsx(Ee,{}),e.jsx(Se,{}),e.jsx(be,{})]})};export{Ye as default};
