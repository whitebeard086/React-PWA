import{r as S,aF as V,aG as O,aH as C,i as R,dg as Z,dh as J,ds as Q,aK as I,k as W,d as X,l as ee,m as $,aL as v,dj as se,j as e,x as ae,F as te,p as ne,q as oe,t as B,v as T,I as le,dk as ie,d1 as re,dl as P,dm as q,z as k,aN as y,o as ce,O as de,ar as ue,u as G,bA as pe,dq as he,c as ge,dn as me,E as xe,dp as be,Y as je,G as fe,dr as ye,L as ve}from"./index-d4dc8e82.js";import{P as Ne}from"./bundle-857a9bbb.js";function Se(s){const[a,t]=S.useState(!1);return S.useEffect(()=>{Array.isArray(s)&&s.length>0||s&&Object.keys(s).length>0?t(!0):t(!1)},[s]),{hasData:a}}const p="data",Pe=V(),w=O(Z,`${p}/data/getOperators`),ke=O(J,`${p}/data/getProducts`),De=O(Q,`${p}/data/buyData`),L=Pe.getInitialState({operators:{...C},products:{...C},bundle:{...C},store:null,pin:"",operator:null,product:null}),M=R({name:`${p}/data`,initialState:L,reducers:{setStore:(s,a)=>{s.store=a.payload===0?null:a.payload},setPin:(s,{payload:a})=>{s.pin=a},setProduct:(s,a)=>{s.product=a.payload===0?null:a.payload},setOperator:(s,a)=>{s.operator=a.payload===0?null:a.payload},resetState:(s,a)=>{const o={user:()=>{s.user=L.user}}[a.payload];o&&o()}},extraReducers:s=>{I(s,w,"operators","data"),I(s,ke,"products","data"),I(s,De,"bundle","data")}}),{setStore:z,resetState:ze,setOperator:Ye,setPin:Ue,setProduct:Ce}=M.actions,Ie=M.reducer,Oe={state:{state:!1,steps:0},kycDialog:!1,pinDialog:!1,query:{search:""}},Y=R({name:`${p}/state`,initialState:Oe,reducers:{setState:(s,{payload:a})=>{s.state.state=a!==0,s.state.steps=a===0?0:a},setSearch:(s,{payload:a})=>{s.query.search=a},toggleKycDialog:(s,{payload:a})=>{s.kycDialog=a},togglePinDialog:(s,{payload:a})=>{s.pinDialog=a}}}),{setState:D,setSearch:He,toggleKycDialog:Ke,togglePinDialog:N}=Y.actions,Ae=Y.reducer,Ee=W({state:Ae,data:Ie}),x=X,Fe=ee().shape({phone:$().matches(/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,"Phone number is not valid").required("Please enter your phone number"),bundle:$().required("Please select bundle")}),_e=()=>{const s=v(),{product:a,store:t}=x(c=>c[p].data),{profile:o}=x(c=>c.auth.user),{isFetching:l,data:u}=se(t),{products:i}=u||{};console.log(i);const g={phone:(a==null?void 0:a.phone)||""},b=({phone:c,bundle:h})=>{var j,f,m;const d=(j=i==null?void 0:i.data)==null?void 0:j.find(r=>r.id===h);if(((f=d==null?void 0:d.meta)==null?void 0:f.fee)>(o==null?void 0:o.balance)){y("Error","You do not have enough balance to complete this transaction, please top-up and try again.","danger",5e3);return}s(Ce({productID:h,bill:t==null?void 0:t.bill,operatorID:t==null?void 0:t.operatorID,device_number:c,amount:Number((m=d==null?void 0:d.meta)==null?void 0:m.fee),package:d==null?void 0:d.name})),s(D(1))};return e.jsx("div",{className:"mt-5",children:e.jsx(ae.div,{initial:{opacity:0,visibility:"hidden"},animate:{opacity:1,visibility:"visible"},transition:{duration:.3,type:"tween"},exit:{opacity:0,visibility:"hidden"},children:e.jsx(te,{initialValues:g,validationSchema:Fe,onSubmit:c=>b(c),children:({touched:c,errors:h,values:d})=>e.jsx(ne,{children:e.jsxs(oe,{children:[e.jsx(B,{label:"Enter Your Phone Number",invalid:h.phone&&c.phone,errorMessage:h.phone,children:e.jsx(T,{type:"text",autoComplete:"off",name:"phone",placeholder:"Phone number",component:le,prefix:e.jsx(ie,{className:"text-xl"})})}),l?e.jsx(re,{size:40,className:"mx-auto mb-4"}):e.jsx(B,{label:"Select a data bundle",invalid:h.bundle&&c.bundle,errorMessage:h.bundle,children:e.jsx(T,{name:"bundle",children:({field:j,form:f})=>{var m;return e.jsx(P,{className:"grid grid-cols-card gap-3",value:[j.value],onChange:r=>f.setFieldValue(j.name,r[0]),children:e.jsx(e.Fragment,{children:(m=i==null?void 0:i.data)==null?void 0:m.filter(r=>r.fee_type!=="RANGE").map(r=>e.jsx(P.Item,{value:r.id,children:({ref:n,active:U,value:Ge,onSegmentItemClick:H,disabled:K})=>{var A,E,F,_;return e.jsx(q,{ref:n,active:U,disabled:K,className:"bg-slate-50",onSegmentItemClick:H,variant:"plain",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx("h6",{children:(A=r==null?void 0:r.meta)==null?void 0:A.data_value}),e.jsx("p",{children:(E=r==null?void 0:r.meta)==null?void 0:E.data_expiry}),e.jsxs("p",{children:["₦",(_=Number((F=r==null?void 0:r.meta)==null?void 0:F.fee))==null?void 0:_.toLocaleString()]})]})})}},r.id))})})}})}),e.jsx(k,{variant:"solid",type:"submit",block:!0,className:"!bg-gray-900 hover:!bg-black",disabled:!d.bundle||!d.phone||l,children:"Continue"})]})})})})})},$e=({operators:s})=>{var o;const a=v(),t={Airtel:"/img/airtel.jpg","9Mobile":"/img/9mobile.png",Glo:"/img/Glo.png",MTN:"/img/MTN.png"};return console.log(s),e.jsx(P,{className:"flex flex-col xx:grid xx:grid-cols-4 gap-3",onChange:l=>{a(z({operatorID:l[0],bill:"telco"}))},children:(o=s==null?void 0:s.data)==null?void 0:o.filter(l=>l.name!=="Visafone").map(l=>e.jsx(P.Item,{value:l.id,children:({ref:u,active:i,value:g,onSegmentItemClick:b,disabled:c})=>e.jsx(q,{ref:u,active:i,disabled:c,className:ce("bg-slate-50",i&&"bg-sky-100"),onSegmentItemClick:b,variant:"plain",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(de,{size:"lg",src:t[l.name],icon:e.jsx(ue,{})}),e.jsx("h6",{children:l==null?void 0:l.name})]})})},l.id))})},Be=()=>{var u;const s=v(),a=G(),{product:t}=x(i=>i[p].data),{hasPin:o}=x(i=>i.auth.user),l=()=>{o?s(N(!0)):a("/transaction-pin")};return e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base mb-2",children:"Your Order"}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Bundle:"}),e.jsx("p",{className:"text-sm font-semibold",children:t==null?void 0:t.package})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Phone Number:"}),e.jsx("p",{className:"text-sm font-semibold",children:t==null?void 0:t.device_number})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsx("p",{className:"text-sm",children:"Bundle Cost:"}),e.jsx("p",{className:"text-sm font-semibold",children:`₦${(u=t==null?void 0:t.amount)==null?void 0:u.toLocaleString()}`})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-8",children:[e.jsx(k,{block:!0,variant:"solid",color:"red-500",icon:e.jsx(pe,{}),className:"",onClick:()=>s(D(0)),children:"Back"}),e.jsx(k,{block:!0,variant:"solid",icon:e.jsx(he,{}),className:"!bg-gray-900 hover:!bg-black",onClick:l,children:"Confirm"})]})]}),e.jsx(Re,{})]})},Te={padding:void 0,margin:void 0,textAlign:void 0,border:void 0,background:void 0,width:void 0,height:void 0},Le={outline:void 0,boxShadow:void 0},Re=()=>{const s=v(),a=G(),t=ge(),[o,l]=S.useState("");let u;const{product:i}=x(n=>n[p].data),{pinDialog:g}=x(n=>n[p].state),b=()=>{s(N(!1))},c=()=>{s(N(!1)),s(D(0))},h=()=>{t.pathname!=="/profile/kyb"&&a("/profile/kyb")},d=()=>{u==null||u.clear(),l("")},j=()=>{const n={pin:o,...i};f(n)},{mutate:f,isLoading:m,error:r}=me(n=>{console.log("error block",n),n.response.data.status==="pin error"?y(n.response.data.message,"The PIN entered does not match your transaction PIN, please try again.","danger",5e3):n.response.status===422?(y(n.response.data.status,n.response.data.message,"danger",5e3),c(),h()):(y("Error",n.response.data.message??"Oops! Something went wrong, please try again.","danger",5e3),c()),d(),b()},n=>{console.log("Success block",n),y("Success",n.message??"Transaction completed successfully.","success",5e3),d(),s(N(!1)),s(je()),s(D(0)),s(z(0))});return e.jsxs(xe,{isOpen:g,onClose:b,onRequestClose:b,shouldCloseOnOverlayClick:!1,shouldCloseOnEsc:!1,contentClassName:"mt-[30vh]",title:"Require PIN",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-700",children:"Authorize Transaction"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm mb-2",children:"Please enter your transaction pin to authorize this transaction"}),e.jsx("div",{children:e.jsx(Ne,{length:4,initialValue:"",secretDelay:200,ref:n=>u=n,onChange:n=>{l(n)},type:"numeric",inputMode:"number",inputStyle:Te,inputFocusStyle:Le,autoSelect:!0,regexCriteria:/^[ A-Za-z0-9_@./#&+-]*$/})}),e.jsx(k,{block:!0,variant:"solid",className:"!bg-gray-900 hover:!bg-black mt-6",icon:e.jsx(be,{}),loading:m,disabled:!o||(o==null?void 0:o.length)<4||m||o[0]==="0",onClick:j,children:"Authorize"})]})]})};fe(`${p}`,Ee);const qe=()=>{const s=v(),{state:a}=x(g=>g[p].state),{products:t,store:o}=x(g=>g[p].data),{data:l,isFetching:u}=ye("telco"),{operators:i}=l||{};return Se(t.data),S.useEffect(()=>{s(w())},[]),console.log("Operators: ",i),e.jsxs("div",{className:"p-4 mt-2",children:[e.jsx("h1",{className:"text-base font-bold pb-4",children:"Mobile Data"}),e.jsx(ve,{loading:u,children:a.state?e.jsx(e.Fragment,{children:a.steps===1&&e.jsx(Be,{})}):e.jsxs(e.Fragment,{children:[e.jsx($e,{operators:i}),o&&e.jsx(_e,{})]})})]})},Ve=qe;export{Ve as default};
