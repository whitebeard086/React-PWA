import{i as _,e as R,db as Y,dc as D,k as $,u as M,dd as L,r as d,j as e,x as v,z as U,aN as N,de as A,G as V,d as O}from"./index-d4dc8e82.js";import{P as y}from"./bundle-857a9bbb.js";const z=_({name:"pin/state",initialState:{},reducers:{}}),B=z.reducer,P=R("profile/data/createPin",async(o,{rejectWithValue:t})=>{try{return(await Y(o)).data}catch(s){return t(s.response.data)}}),S=R("profile/data/updatePin",async(o,{rejectWithValue:t})=>{try{return(await D(o)).data}catch(s){return t(s.response.data)}}),G=_({name:"pin/data",initialState:{loading:!1,status:"idle",message:""},reducers:{setStatus:(o,t)=>{o.status=t.payload}},extraReducers:o=>{o.addCase(P.pending,t=>{t.loading=!0}).addCase(P.fulfilled,(t,s)=>{t.loading=!1;const{status:i}=s.payload;t.status=i}).addCase(P.rejected,(t,s)=>{t.loading=!1;const{status:i,message:c}=s.payload;t.status=i,t.message=c}).addCase(S.pending,t=>{t.loading=!0}).addCase(S.fulfilled,(t,s)=>{t.loading=!1;const{status:i}=s.payload;t.status=i}).addCase(S.rejected,(t,s)=>{t.loading=!1;const{status:i,message:c}=s.payload;t.status=i,t.message=c})}}),q=G.reducer,H=$({state:B,data:q}),E={padding:void 0,margin:void 0,textAlign:void 0,border:void 0,background:void 0,width:void 0,height:void 0},T={outline:void 0,boxShadow:void 0},J=()=>{const o=M(),[t,{isLoading:s}]=L(),[i,c]=d.useState(""),[r,b]=d.useState(""),[l,p]=d.useState("");let h=!1,u=!1;r.length===4&&r!==i&&(h=!0),r.length===4&&r===i&&(u=!0);const g=async()=>{try{await t({pin:i,pin_confirmation:r}).unwrap(),N("Success","Transaction PIN created successfully.","success",5e3),o(-1)}catch{N("Error","Oops! Something went wrong, please try again.","danger",5e3)}},x=n=>{if(n[0]==="0")return p("First digit cannot be 0"),!1;if(n==="0000")return p("PIN cannot be 0000"),!1;for(let m=1;m<n.length;m++)if(n[m]===n[m-1])return p("No digit should be the same as the previous one"),!1;return p(""),!0};return e.jsx("div",{children:e.jsxs("form",{onSubmit:async n=>{n.preventDefault(),g()},children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-base mb-2",children:"Enter PIN"}),e.jsx(y,{length:4,initialValue:"",secretDelay:200,onChange:n=>{x(n)&&c(n)},type:"numeric",inputMode:"number",inputStyle:E,inputFocusStyle:T,autoSelect:!0,regexCriteria:/^[1-9][0-9]*$/}),l&&e.jsx(v.p,{className:"text-red-500 mt-2",layoutId:2,initial:{opacity:0,visibility:"hidden"},animate:{opacity:1,visibility:"visible"},transition:{duration:.4,type:"tween"},exit:{opacity:0,visibility:"hidden"},children:l},2)]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-base mb-2",children:"Enter PIN Again"}),e.jsx(y,{length:4,initialValue:"",secretDelay:200,disabled:i.length<4,onChange:n=>{b(n)},type:"numeric",inputMode:"number",inputStyle:E,inputFocusStyle:T,autoSelect:!0,regexCriteria:/^[1-9][0-9]*$/}),h&&e.jsx(v.p,{className:"text-red-500 mt-2",layoutId:1,initial:{opacity:0,visibility:"hidden"},animate:{opacity:1,visibility:"visible"},transition:{duration:.4,type:"tween"},exit:{opacity:0,visibility:"hidden"},children:"Your PIN do not match!"},1)]}),e.jsx(U,{block:!0,type:"submit",variant:"solid",className:"!bg-gray-900 hover:!bg-black mt-2",loading:s,disabled:!i||!r||i.length<4||r.length<4||h||!u,children:"Create"})]})})},j={padding:void 0,margin:void 0,textAlign:void 0,border:void 0,background:void 0,width:void 0,height:void 0},I={outline:void 0,boxShadow:void 0},K=()=>{const o=M(),[t,{isLoading:s}]=A(),[i,c]=d.useState(""),[r,b]=d.useState(""),[l,p]=d.useState(""),[h,u]=d.useState("");let g=!1,x=!1;const n=d.useRef(null),m=d.useRef(null),C=d.useRef(null),F=a=>{if(a[0]==="0")return u("First digit cannot be 0"),!1;if(a==="0000")return u("PIN cannot be 0000"),!1;for(let f=1;f<a.length;f++)if(a[f]===a[f-1])return u("No digit should be the same as the previous one"),!1;return u(""),!0};l.length===4&&l!==r&&(g=!0),l.length===4&&l===r&&(x=!0);const w=()=>{n.current.clear(),m.current.clear(),C.current.clear(),c(""),b(""),p(""),u("")},k=async()=>{try{console.log(r),await t({old_pin:i,pin:r,pin_confirmation:l}).unwrap(),N("Success","Transaction PIN updated successfully.","success",5e3),w(),o(-1)}catch(a){console.log(a.data),N(a.data.status,a.data.message,"warning",5e3),w()}};return e.jsx("div",{children:e.jsxs("form",{onSubmit:async a=>{a.preventDefault(),k()},children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-base mb-2",children:"Enter Old PIN"}),e.jsx(y,{length:6,initialValue:"",secretDelay:200,ref:n,onChange:a=>{c(a)},type:"numeric",inputMode:"number",inputStyle:j,inputFocusStyle:I,autoSelect:!0,regexCriteria:/^[1-9][0-9]*$/})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-base mb-2",children:"Enter New PIN"}),e.jsx(y,{length:4,initialValue:"",secretDelay:200,ref:m,disabled:i.length<4,onChange:a=>{F(a)&&b(a)},type:"numeric",inputMode:"number",inputStyle:j,inputFocusStyle:I,autoSelect:!0,regexCriteria:/^[1-9][0-9]*$/}),h&&e.jsx(v.p,{className:"text-red-500 mt-2",layoutId:2,initial:{opacity:0,visibility:"hidden"},animate:{opacity:1,visibility:"visible"},transition:{duration:.4,type:"tween"},exit:{opacity:0,visibility:"hidden"},children:h},2)]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-base mb-2",children:"Enter New PIN Again"}),e.jsx(y,{length:4,initialValue:"",secretDelay:200,ref:C,disabled:r.length<4,onChange:a=>{p(a)},type:"numeric",inputMode:"number",inputStyle:j,inputFocusStyle:I,autoSelect:!0,regexCriteria:/^[1-9][0-9]*$/}),g&&e.jsx(v.p,{className:"text-red-500 mt-2",layoutId:1,initial:{opacity:0,visibility:"hidden"},animate:{opacity:1,visibility:"visible"},transition:{duration:.4,type:"tween"},exit:{opacity:0,visibility:"hidden"},children:"Your PIN do not match!"},1)]}),e.jsx(U,{block:!0,type:"submit",variant:"solid",className:"!bg-gray-900 hover:!bg-black mt-2",loading:s,disabled:!i||!r||!l||i.length<4||r.length<4||l.length<4||g||!x,children:"Update"})]})})};V("pin",H);const X=()=>{const{hasPin:o}=O(t=>t.auth.user);return e.jsx("div",{className:"mt-2 p-4",children:o?e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-gray-700 mb-4",children:"Update Your Transaction PIN"}),e.jsx("div",{className:"mt-4",children:e.jsx(K,{})})]}):e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-gray-700 mb-4",children:"Create Your Transaction PIN"}),e.jsx("div",{className:"mt-4",children:e.jsx(J,{})})]})})};export{X as default};
